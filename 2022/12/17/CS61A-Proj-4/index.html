<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>CS61A Proj 4 | Misaka's blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({google_ad_client: "ca-pub-5060306535186583", enable_page_level_ads: true});</script><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CS61A Proj 4</h1><a id="logo" href="/.">Misaka's blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a><a href="/messageboard/"><i class="fa fa fa-comments"> 留言版</i></a><a href="/link/"><i class="fa fa fa-external-link"> 友链</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">CS61A Proj 4</h1><div class="post-meta">2022-12-17<span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 13.1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 81</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><h1>Project 4: Scheme Interpreter</h1>
<p><img src="https://cdn.jsdelivr.net/gh/Misaka-9982-coder/img_hosting/img/money_tree.png" alt="img"></p>
<p><em>Eval calls apply,</em></p>
<p><em>which just calls eval again!</em></p>
<p><em>When does it all end?</em></p>
<h2 id="Introduction-6">Introduction</h2>
<blockquote>
<p><strong>Note:</strong> If you’re interested in an alternate version of this project that gives you considerably less scaffolding and guidance, you can try the <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/proj/scheme_stubbed/">Scheme Challenge Version</a>! For grading purposes, completing either version of the project (this version or the Challenge version) will be equivalent.</p>
</blockquote>
<blockquote>
<p><strong>Important submission note:</strong> For full credit,</p>
<ul>
<li>Submit with Part 1 complete by <strong>Tuesday, April 12</strong> (worth 1 pt).</li>
<li>Submit with Parts 2 &amp; 3 (including passing all tests provided in <code>tests.scm</code>) complete by <strong>Tuesday, April 19</strong> (worth 1 pt).</li>
<li>Submit with all phases complete by <strong>Tuesday, April 26</strong>.</li>
</ul>
<p>Try to attempt the problems in order, as some later problems will depend on earlier problems in their implementation and therefore also when running <code>ok</code> tests.</p>
<p>The entire project can be completed with a partner.</p>
<p>You can get 1 bonus point by submitting the entire project by <strong>Monday, April 25</strong>.</p>
</blockquote>
<p>In this project, you will develop an interpreter for a subset of the Scheme language. As you proceed, think about the issues that arise in the design of a programming language; many quirks of languages are byproducts of implementation decisions in interpreters and compilers. The subset of the language used in this project is described in the <a target="_blank" rel="noopener" href="http://composingprograms.com/pages/32-functional-programming.html">functional programming</a> section of Composing Programs, as well as this <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/">language specification</a> and <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-builtins/">built-in procedure reference</a> for the CS 61A subset of Scheme that you’ll be building in this project.</p>
<p>Watch (or attend) the lectures on Calculator and Interpreters for an overview of the project.</p>
<p>In addition, there will be a completely optional open-ended art contest (released separately) that challenges you to produce recursive images in only a few lines of Scheme. As an example, the picture above abstractly depicts all the ways of making change for $0.50 using U.S. currency. All flowers appear at the end of a branch with length 50. Small angles in a branch indicate an additional coin, while large angles indicate a new currency denomination. In the contest, you too will have the chance to unleash your inner recursive artist.</p>
<h2 id="Download-starter-files-4">Download starter files</h2>
<p>You can download all of the project code as a <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/proj/scheme/scheme.zip">zip archive</a>.</p>
<p>Files you will edit:</p>
<ul>
<li><code>scheme_eval_apply.py</code>: the recursive evaluator for Scheme expressions</li>
<li><code>scheme_forms.py</code>: evaluation for special forms</li>
<li><code>scheme_classes.py</code>: classes that describe Scheme expressions</li>
<li><code>questions.scm</code>: contains skeleton code for Part 3</li>
</ul>
<p>The rest of the files in the project:</p>
<ul>
<li><code>scheme.py</code>: the interpreter REPL</li>
<li><code>pair.py</code>: defines the <code>Pair</code> class and the <code>nil</code> object</li>
<li><code>scheme_builtins.py</code>: built-in Scheme procedures</li>
<li><code>scheme_reader.py</code>: the reader for Scheme input (this file is obfuscated so that you can implement it in lab)</li>
<li><code>scheme_tokens.py</code>: the tokenizer for Scheme input</li>
<li><code>scheme_utils.py</code>: functions for inspecting Scheme expressions</li>
<li><code>ucb.py</code>: utility functions for use in 61A projects</li>
<li><code>tests.scm</code>: a collection of test cases written in Scheme</li>
<li><code>ok</code>: the autograder</li>
<li><code>tests</code>: a directory of tests used by <code>ok</code></li>
<li><code>mytests.rst</code>: a file where you can add your own tests</li>
</ul>
<h2 id="Logistics-4">Logistics</h2>
<p>The project is worth points. 28 points are for correctness, which is including 1 point for passing <code>tests.scm</code>. 1 point is for submitting Part 1 by the first checkpoint date, and 1 point is for submitting Parts 2 &amp; 3 by the second checkpoint date.</p>
<p>Additionally, there are some extra credit point opportunities. You can get 1 EC point for submitting the entire project by <strong>Monday, April 25</strong>, and 2 EC points for submitting the extra credit problem.</p>
<blockquote>
<p><strong>Important:</strong> In order to receive all of the possible extra credit points for Scheme, your implementation of the entire project, <em>including</em> the EC problem, must be submitted by the early submission deadline.</p>
</blockquote>
<p>You will turn in the following files:</p>
<ul>
<li><code>scheme_eval_apply.py</code></li>
<li><code>scheme_forms.py</code></li>
<li><code>scheme_classes.py</code></li>
<li><code>questions.scm</code></li>
</ul>
<p>You do not need to modify or turn in any other files to complete the project. To submit the project, run the following command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok --submit</span><br></pre></td></tr></table></figure>
<p>You will be able to view your submissions on the <a target="_blank" rel="noopener" href="http://ok.cs61a.org/">Ok dashboard</a>.</p>
<p>For the functions that we ask you to complete, there may be some initial code that we provide. If you would rather not use that code, feel free to delete it and start from scratch. You may also add new function definitions as you see fit.</p>
<p><strong>However, please do not modify any other functions or edit any files not listed above.</strong> Doing so may result in your code failing our autograder tests. Also, please do not change any function signatures (names, argument order, or number of arguments).</p>
<p>Throughout this project, you should be testing the correctness of your code. It is good practice to test often, so that it is easy to isolate any problems. However, you should not be testing too often, to allow yourself time to think through problems.</p>
<p>We have provided an <strong>autograder</strong> called <code>ok</code> to help you with testing your code and tracking your progress. The first time you run the autograder, you will be asked to <strong>log in with your Ok account using your web browser</strong>. Please do so. Each time you run <code>ok</code>, it will back up your work and progress on our servers.</p>
<p>The primary purpose of <code>ok</code> is to test your implementations.</p>
<p>We recommend that you submit <strong>after you finish each problem</strong>. Only your last submission will be graded. It is also useful for us to have more backups of your code in case you run into a submission issue. <strong>If you forget to submit, your last backup will be automatically converted to a submission.</strong></p>
<p>If you do not want us to record a backup of your work or information about your progress, you can run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok --local</span><br></pre></td></tr></table></figure>
<p>With this option, no information will be sent to our course servers. If you want to test your code interactively, you can run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q [question number] -i</span><br></pre></td></tr></table></figure>
<p>with the appropriate question number (e.g. <code>01</code>) inserted. This will run the tests for that question until the first one you failed, then give you a chance to test the functions you wrote interactively.</p>
<p>You can also use the debugging print feature in OK by writing</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(&quot;DEBUG:&quot;, x)</span><br></pre></td></tr></table></figure>
<p>which will produce an output in your terminal without causing OK tests to fail with extra output.</p>
<h2 id="Interpreter-details">Interpreter details</h2>
<h3 id="Scheme-features">Scheme features</h3>
<p><strong>Read-Eval-Print.</strong> The interpreter reads Scheme expressions, evaluates them, and displays the results.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; 2</span><br><span class="line">2</span><br><span class="line">scm&gt; (+ 2 3)</span><br><span class="line">5</span><br><span class="line">scm&gt; ((lambda (x) (* x x)) 5)</span><br><span class="line">25</span><br></pre></td></tr></table></figure>
<p>The starter code for your Scheme interpreter can successfully evaluate the first expression above, since it consists of a single number. The second (a call to a built-in procedure) and the third (a computation of 5 squared) will not work just yet.</p>
<p><strong>Load.</strong> You can load a file by passing in a symbol for the file name. For example, to load <code>tests.scm</code>, evaluate the following call expression.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (load &#x27;tests)</span><br></pre></td></tr></table></figure>
<p><strong>Symbols.</strong> Various dialects of Scheme are more or less permissive about identifiers (which serve as symbols and variable names).</p>
<p>Our rule is that:</p>
<blockquote>
<p>An identifier is a sequence of letters (a-z and A-Z), digits, and characters in <code>!$%&amp;*/:&lt;=&gt;?@^_~-+.</code> that do not form a valid integer or floating-point numeral and are not existing special form shorthands.</p>
</blockquote>
<p>Our version of Scheme is case-insensitive: two identifiers are considered identical if they differ only in the capitalization of letters. They are internally represented and printed in lower case:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; &#x27;Hello</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<p><strong>Turtle Graphics.</strong> In addition to standard Scheme procedures, we include procedure calls to the Python <code>turtle</code> package. This will come in handy for the contest. You <strong>do not</strong> have to install this package in order to participate.</p>
<p>If you’re curious, you can read the <a target="_blank" rel="noopener" href="http://docs.python.org/py3k/library/turtle.html">turtle module documentation</a> online.</p>
<h3 id="Running-the-interpreter">Running the interpreter</h3>
<p>To start an interactive Scheme interpreter session, type:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 scheme.py</span><br></pre></td></tr></table></figure>
<p>Currently, your Scheme interpreter can handle a few simple expressions, such as:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; 1</span><br><span class="line">1</span><br><span class="line">scm&gt; 42</span><br><span class="line">42</span><br><span class="line">scm&gt; true</span><br><span class="line">#t</span><br></pre></td></tr></table></figure>
<p>To exit the Scheme interpreter, press <code>Ctrl-d</code> or evaluate the <code>exit</code> procedure (after completing problems 3 and 4):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (exit)</span><br></pre></td></tr></table></figure>
<p>You can use your Scheme interpreter to evaluate the expressions in an input file by passing the file name as a command-line argument to <code>scheme.py</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 scheme.py tests.scm</span><br></pre></td></tr></table></figure>
<p>The <code>tests.scm</code> file contains a long list of sample Scheme expressions and their expected values. Many of these examples are from Chapters 1 and 2 of <a target="_blank" rel="noopener" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-4.html#%25_toc_start">Structure and Interpretation of Computer Programs</a>, the textbook from which Composing Programs is adapted.</p>
<h2 id="Part-1-The-Evaluator">Part 1: The Evaluator</h2>
<p>In Part 1, you will develop the following features of the interpreter:</p>
<ul>
<li>Symbol evaluation</li>
<li>Calling built-in procedures</li>
<li>Definitions</li>
</ul>
<p>In the starter implementation given to you, the evaluator can only evaluate self-evaluating expressions: numbers, booleans, and <code>nil</code>.</p>
<p>First, read the relevant code. In the “Eval/Apply” section of <code>scheme_eval_apply.py</code>:</p>
<ul>
<li><code>scheme_eval</code> evaluates a Scheme expression in the given environment. This function is nearly complete but is missing the logic for call expressions.</li>
<li>When evaluating a special form, <code>scheme_eval</code> redirects evaluation to an appropriate <code>do_?_form</code> function found in <code>scheme_forms.py</code></li>
<li><code>scheme_apply</code> applies a procedure to some arguments. This function has cases for the various types of procedures (builtin procedures, user-defined procedures, and so forth) that you will implement.</li>
</ul>
<p>In the “Environments” and “Procedures” section of <code>scheme_classes.py</code>:</p>
<ul>
<li>The <code>Frame</code> class implements an environment frame.</li>
<li>The <code>LambdaProcedure</code> class (in the “Procedures” section) represents user-defined procedures.</li>
</ul>
<p>These are all of the essential components of the interpreter. <code>scheme_forms.py</code> defines special forms, <code>scheme_builtins.py</code> defines the various functions built into the standard library, and <code>scheme.py</code> defines input/output behavior.</p>
<p>Use Ok to test your understanding:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q eval_apply -u</span><br></pre></td></tr></table></figure>
<h3 id="Problem-1-1-pt-3">Problem 1 (1 pt)</h3>
<p>Implement the <code>define</code> and <code>lookup</code> methods of the <code>Frame</code> class, in <code>scheme_classes.py</code>. Each <code>Frame</code> object has the following instance attributes:</p>
<ul>
<li><code>bindings</code> is a dictionary representing the bindings in the frame. It maps Scheme symbols (represented as Python strings) to Scheme values.</li>
<li><code>parent</code> is the parent <code>Frame</code> instance. The parent of the Global Frame is <code>None</code>.</li>
</ul>
<ol>
<li>
<p><code>define</code> takes a symbol (represented by a Python string) and a value. It binds the symbol to the value in the <code>Frame</code> instance.</p>
</li>
<li>
<pre><code class="language-plaintext">lookup
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">takes a symbol and returns the value bound to that symbol in the first frame of the environment in which the symbol is bound. The</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">environment</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">for a</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">```plaintext</span><br><span class="line">Frame</span><br></pre></td></tr></table></figure>

 

instance consists of that frame, its parent frame, and all its ancestor frames, including the Global Frame. This is explained below:

- If the symbol is bound in the current frame, return its value.
- If the symbol is not bound in the current frame, and the frame has a parent frame, continue lookup in the parent frame.
- If the symbol is not found in the current frame and there is no parent frame, raise a SchemeError.

</code></pre>
</li>
</ol>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 01 -u</span><br><span class="line">python3 ok -q 01</span><br></pre></td></tr></table></figure>
<p>After you complete this problem, you can start your Scheme interpreter (with <code>python3 scheme.py</code>). You should be able to look up built-in procedure names:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; +</span><br><span class="line">#[+]</span><br><span class="line">scm&gt; odd?</span><br><span class="line">#[odd?]</span><br></pre></td></tr></table></figure>
<p>However, your Scheme interpreter will still not be able to call these procedures. Let’s fix that.</p>
<p>Remember, at this point you can only exit the interpreter by pressing <code>Ctrl-d</code>.</p>
<h3 id="Problem-2-2-pt">Problem 2 (2 pt)</h3>
<p>To be able to call built-in procedures, such as <code>+</code>, you need to complete the <code>BuiltinProcedure</code> case within the <code>scheme_apply</code> function in <code>scheme_eval_apply.py</code>. Built-in procedures are applied by calling a corresponding Python function that implements the procedure.</p>
<blockquote>
<p>To see a list of all Scheme built-in procedures used in the project, look in the <code>scheme_builtins.py</code> file. Any function decorated with <code>@builtin</code> will be added to the globally-defined <code>BUILTINS</code> list.</p>
</blockquote>
<p>A <code>BuiltinProcedure</code> has two instance attributes:</p>
<ul>
<li><code>py_func</code>: the Python function that implements the built-in Scheme procedure.</li>
<li><code>expect_env</code>: a Boolean flag that indicates whether or not this built-in procedure will expect the current environment to be passed in as the last argument. The environment is required, for instance, to implement the built-in <code>eval</code> procedure.</li>
</ul>
<p><code>scheme_apply</code> takes the <code>procedure</code> object, a list of argument values, and the current environment. <code>args</code> is a Scheme list represented as a <code>Pair</code> object or <code>nil</code>. Your implementation should do the following:</p>
<ul>
<li>Convert the Scheme list to a Python list of arguments. <em>Hint:</em> <code>args</code> is a Pair, which has a <code>.first</code> and <code>.rest</code> similar to a Linked List. Think about how you would put the values of a Linked List into a list.</li>
<li>If <code>procedure.expect_env</code> is <code>True</code>, then add the current environment <code>env</code> as the last argument to this Python list.</li>
<li>Call <code>procedure.py_func</code> on all of those arguments using <code>*args</code> notation (<code>f(1, 2, 3)</code> is equivalent to <code>f(*[1, 2, 3])</code>).</li>
<li>If calling the function results in a <code>TypeError</code> exception being raised, then the wrong number of arguments were passed. Use a <code>try</code>/<code>except</code> block to intercept the exception and raise a <code>SchemeError</code> with the message <code>'incorrect number of arguments'</code>.</li>
<li>Otherwise, <code>scheme_apply</code> should return the value obtained by calling <code>procedure.py_func</code></li>
</ul>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 02 -u</span><br><span class="line">python3 ok -q 02</span><br></pre></td></tr></table></figure>
<p>👩🏽‍💻👨🏿‍💻 <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/pair-programming">Pair programming?</a> Remember to alternate between driver and navigator roles. The driver controls the keyboard; the navigator watches, asks questions, and suggests ideas.</p>
<h3 id="Problem-3-2-pt-2">Problem 3 (2 pt)</h3>
<p>The <code>scheme_eval</code> function (in <code>scheme_eval_apply.py</code>) evaluates a Scheme expression (represented as a <code>Pair</code>) in a given environment. The provided code already looks up names in the current environment, returns self-evaluating expressions (such as numbers) and evaluates special forms.</p>
<p>Implement the missing part of <code>scheme_eval</code>, which evaluates a call expression. To evaluate a call expression:</p>
<ol>
<li>Evaluate the operator (which should evaluate to an instance of <code>Procedure</code>)</li>
<li>Evaluate all of the operands</li>
<li>Apply the procedure on the evaluated operands by calling <code>scheme_apply</code>, then return the result</li>
</ol>
<p>You’ll have to recursively call <code>scheme_eval</code> in the first two steps. Here are some other functions/methods you should use:</p>
<ul>
<li>The <code>map</code> method of <code>Pair</code> returns a new Scheme list constructed by applying a one-argument function to every item in a Scheme list.</li>
<li>The <code>scheme_apply</code> function applies a Scheme procedure to arguments represented as a Scheme list (a <code>Pair</code> instance).</li>
</ul>
<p>Important: do not mutate the passed-in <code>expr</code>. That would change a program as it’s being evaluated, creating strange and incorrect effects.</p>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 03 -u</span><br><span class="line">python3 ok -q 03</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Some of these tests call a primitive (built-in) procedure called <code>print-then-return</code>. This procedure doesn’t exist in Scheme, but was added to this project just to test this question. <code>print-then-return</code> takes two arguments. It prints out its first argument and returns the second. You can find this function at the bottom of <code>scheme_builtins.py</code></p>
</blockquote>
<p>Your interpreter should now be able to evaluate built-in procedure calls, giving you the functionality of the Calculator language and more. Run <code>python3 scheme.py</code>, and you can now add and multiply!</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (+ 1 2)</span><br><span class="line">3</span><br><span class="line">scm&gt; (* 3 4 (- 5 2) 1)</span><br><span class="line">36</span><br><span class="line">scm&gt; (odd? 31)</span><br><span class="line">#t</span><br></pre></td></tr></table></figure>
<h3 id="Problem-4-2-pt-2">Problem 4 (2 pt)</h3>
<p>The <code>define</code> special form (<a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#define">spec</a>) in Scheme can be used either to assign a name to the value of a given expression or to create a procedure and bind it to a name:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (define a (+ 2 3))  ; Binds the name a to the value of (+ 2 3)</span><br><span class="line">a</span><br><span class="line">scm&gt; (define (foo x) x)  ; Creates a procedure and binds it to the name foo</span><br><span class="line">foo</span><br></pre></td></tr></table></figure>
<p>The type of the first operand tells us what is being defined:</p>
<ul>
<li>If it is a symbol, e.g. <code>a</code>, then the expression is defining a name</li>
<li>If it is a list, e.g. <code>(foo x)</code>, then the expression is defining a procedure.</li>
</ul>
<p>The <code>do_define_form</code> function in <code>scheme_forms.py</code> evaluates <code>(define ...)</code> expressions. There are two missing parts in this function. For this problem, implement <strong>just the first</strong> part, which evaluates the second operand to obtain a value and binds the first operand, a symbol, to that value. Then, <code>do_define_form</code> returns the symbol that was bound.</p>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 04 -u</span><br><span class="line">python3 ok -q 04</span><br></pre></td></tr></table></figure>
<p>You should now be able to give names to values and evaluate the resulting symbols. For example, here are some test cases from the <code>ok</code> tests for this question.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (define x 15)</span><br><span class="line">x</span><br><span class="line">scm&gt; (define y (* 2 x))</span><br><span class="line">y</span><br><span class="line">scm&gt; y</span><br><span class="line">30</span><br><span class="line">scm&gt; (+ y (* y 2) 1)</span><br><span class="line">91</span><br><span class="line">scm&gt; (define x 20)</span><br><span class="line">x</span><br><span class="line">scm&gt; x</span><br><span class="line">20</span><br></pre></td></tr></table></figure>
<p>For this test, the goal is to highlight whether the operator is evaluated multiple times before raising an error. The expected, and intended behavior is for the operator to be evaluated only a <em>single</em> time before raising the error.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(define x 0)</span><br><span class="line">; expect x</span><br><span class="line">((define x (+ x 1)) 2)</span><br><span class="line">; expect Error</span><br><span class="line">x</span><br><span class="line">; expect 1</span><br></pre></td></tr></table></figure>
<p>We expect an error to be raised here since the operator does not evaluate to a procedure. However, if the operator is evaluated multiple times before raising an error, x will be bound to 2 instead of 1, causing the test to fail. Therefore, if your interpreter fails this test, you’ll want to make sure you only evaluate the operator once in <code>scheme_eval</code>.</p>
<h3 id="Problem-5-1-pt">Problem 5 (1 pt)</h3>
<p>In Scheme, you can quote expressions in two ways: with the <code>quote</code> special form (<a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#quote">spec</a>) or with the symbol ‘. The reader converts <code>'...</code> into <code>(quote ...)</code>, so that your interpreter only needs to evaluate the <code>(quote ...)</code> syntax. The <code>quote</code> special form returns its operand expression without evaluating it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (quote hello)</span><br><span class="line">hello</span><br><span class="line">scm&gt; &#x27;(cons 1 2)  ; Equivalent to (quote (cons 1 2))</span><br><span class="line">(cons 1 2)</span><br></pre></td></tr></table></figure>
<p>Implement the <code>do_quote_form</code> function in <code>scheme_forms.py</code> so that it simply returns the unevaluated operand of the <code>(quote ...)</code> expression.</p>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 05 -u</span><br><span class="line">python3 ok -q 05</span><br></pre></td></tr></table></figure>
<p>After completing this function, you should be able to evaluate quoted expressions. Try out some of the following in your interpreter!</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (quote a)</span><br><span class="line">a</span><br><span class="line">scm&gt; (quote (1 2))</span><br><span class="line">(1 2)</span><br><span class="line">scm&gt; (quote (1 (2 three (4 5))))</span><br><span class="line">(1 (2 three (4 5)))</span><br><span class="line">scm&gt; (car (quote (a b)))</span><br><span class="line">a</span><br><span class="line">scm&gt; &#x27;hello</span><br><span class="line">hello</span><br><span class="line">scm&gt; &#x27;(1 2)</span><br><span class="line">(1 2)</span><br><span class="line">scm&gt; &#x27;(1 (2 three (4 5)))</span><br><span class="line">(1 (2 three (4 5)))</span><br><span class="line">scm&gt; (car &#x27;(a b))</span><br><span class="line">a</span><br><span class="line">scm&gt; (eval (cons &#x27;car &#x27;(&#x27;(1 2))))</span><br><span class="line">1</span><br><span class="line">scm&gt; (eval (define tau 6.28))</span><br><span class="line">6.28</span><br><span class="line">scm&gt; (eval &#x27;tau)</span><br><span class="line">6.28</span><br><span class="line">scm&gt; tau</span><br><span class="line">6.28</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Once you have completed Problem 5, make sure you submit using OK to receive full credit for the first checkpoint.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok --submit</span><br></pre></td></tr></table></figure>
<p>If you’d like to check your score so far, use the following command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok --score</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Part-2-Procedures">Part 2: Procedures</h2>
<p>In Part 2, you will add the ability to create and call user-defined procedures. You will add the following features to the interpreter:</p>
<ul>
<li>Lambda procedures, using the <code>(lambda ...)</code> special form</li>
<li>Named lambda procedures, using the <code>(define (...) ...)</code> special form</li>
<li>Mu procedures, with <em>dynamic scope</em></li>
</ul>
<h3 id="User-Defined-Procedures">User-Defined Procedures</h3>
<p>User-defined lambda procedures are represented as instances of the <code>LambdaProcedure</code> class. A <code>LambdaProcedure</code> instance has three instance attributes:</p>
<ul>
<li><code>formals</code> is a Scheme list of the formal parameters (symbols) that name the arguments of the procedure.</li>
<li><code>body</code> is a Scheme list of expressions; the body of the procedure.</li>
<li><code>env</code> is the environment in which the procedure was <strong>defined</strong>.</li>
</ul>
<h3 id="Problem-6-1-pt-2">Problem 6 (1 pt)</h3>
<p>Change the <code>eval_all</code> function in <code>scheme_eval_apply.py</code> (which is called from <code>do_begin_form</code> in <code>scheme_forms.py</code>) to complete the implementation of the <code>begin</code> special form (<a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#begin">spec</a>).</p>
<p>A <code>begin</code> expression is evaluated by evaluating all sub-expressions in order. The value of the <code>begin</code> expression is the value of the final sub-expression.</p>
<p>To complete the implementation of <code>begin</code>, <code>eval_all</code> will take in <code>expressions</code> (a Scheme list of expressions) and <code>env</code> (a <code>Frame</code> representing the current environment), evaluate all the expressions in <code>expressions</code>, and return the value of the last expression in <code>expressions</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (begin (+ 2 3) (+ 5 6))</span><br><span class="line">11</span><br><span class="line">scm&gt; (define x (begin (display 3) (newline) (+ 2 3)))</span><br><span class="line">3</span><br><span class="line">x</span><br><span class="line">scm&gt; (+ x 3)</span><br><span class="line">8</span><br><span class="line">scm&gt; (begin (print 3) &#x27;(+ 2 3))</span><br><span class="line">3</span><br><span class="line">(+ 2 3)</span><br></pre></td></tr></table></figure>
<p>If <code>eval_all</code> is passed an empty list of expressions (<code>nil</code>), then it should return the Python value <code>None</code>, which represents the Scheme value <code>undefined</code>.</p>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 06 -u</span><br><span class="line">python3 ok -q 06</span><br></pre></td></tr></table></figure>
<p>👩🏽‍💻👨🏿‍💻 <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/pair-programming">Pair programming?</a> This would be a good time to switch roles. Switching roles makes sure that you both benefit from the learning experience of being in each role.</p>
<h3 id="Problem-7-2-pt">Problem 7 (2 pt)</h3>
<p>Implement the <code>do_lambda_form</code> function (<a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#lambda">spec</a>) in <code>scheme_forms.py</code>, which creates and returns a <code>LambdaProcedure</code> instance. While you cannot call a user-defined procedure yet, you can verify that you have created the procedure correctly by typing a lambda expression into the interpreter prompt:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (lambda (x y) (+ x y))</span><br><span class="line">(lambda (x y) (+ x y))</span><br></pre></td></tr></table></figure>
<p>In Scheme, it is legal to place more than one expression in the body of a procedure. (There must be at least one expression.) The <code>body</code> attribute of a <code>LambdaProcedure</code> instance is therefore a Scheme list of body expressions. The <code>formals</code> attribute of a <code>LambdaProcedure</code> instance should be a properly nested <code>Pair</code> expression. Like a <code>begin</code> special form, evaluating the body of a procedure evaluates all body expressions in order. The return value of a procedure is the value of its last body expression.</p>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 07 -u</span><br><span class="line">python3 ok -q 07</span><br></pre></td></tr></table></figure>
<h3 id="Problem-8-2-pt">Problem 8 (2 pt)</h3>
<p>Implement the <code>make_child_frame</code> method of the <code>Frame</code> class (in <code>scheme_classes.py</code>), which will be used to create new frames when calling user-defined procedures. This method takes in two arguments: <code>formals</code>, which is a Scheme list of symbols, and <code>vals</code>, which is a Scheme list of values. It should return a new child frame, binding the formal parameters to the values.</p>
<p>To do this:</p>
<ul>
<li>If the number of argument values does not match with the number of formal parameters, raise a <code>SchemeError</code>.</li>
<li>Create a new <code>Frame</code> instance, the parent of which is <code>self</code>.</li>
<li>Bind each formal parameter to its corresponding argument value in the newly created frame. The first symbol in <code>formals</code> should be bound to the first value in <code>vals</code>, and so on.</li>
<li>Return the new frame.</li>
</ul>
<blockquote>
<p><em>Hint:</em> The <code>define</code> method of a <code>Frame</code> instance creates a binding in that frame.</p>
</blockquote>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 08 -u</span><br><span class="line">python3 ok -q 08</span><br></pre></td></tr></table></figure>
<h3 id="Problem-9-2-pt">Problem 9 (2 pt)</h3>
<p>Implement the <code>LambdaProcedure</code> case in the <code>scheme_apply</code> function (in <code>scheme_eval_apply.py</code>).</p>
<p>You should first create a new <code>Frame</code> instance using the <code>make_child_frame</code> method of the appropriate parent frame, binding formal parameters to argument values. Then, evaluate each of the expressions of the body of the procedure using <code>eval_all</code> within this new frame.</p>
<p>Your new frame should be a child of the frame in which the lambda is defined. Note that the <code>env</code> provided as an argument to <code>scheme_apply</code> is instead the frame in which the procedure is called. See <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/proj/scheme/#user-defined-procedures">User-Defined Procedures</a> to remind yourself of the attributes of <code>LambdaProcedure</code>.</p>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 09 -u</span><br><span class="line">python3 ok -q 09</span><br></pre></td></tr></table></figure>
<h3 id="Problem-10-1-pt-2">Problem 10 (1 pt)</h3>
<p>Currently, your Scheme interpreter is able to bind symbols to user-defined procedures in the following manner:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (define f (lambda (x) (* x 2)))</span><br><span class="line">f</span><br></pre></td></tr></table></figure>
<p>However, we’d like to be able to use the shorthand form of defining named procedures:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (define (f x) (* x 2))</span><br><span class="line">f</span><br></pre></td></tr></table></figure>
<p>Modify the <code>do_define_form</code> function in <code>scheme_forms.py</code> so that it correctly handles <code>define (...) ...)</code> expressions (<a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#define">spec</a>).</p>
<p>Make sure that it can handle multi-expression bodies. For example,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (define (g y) (print y) (+ y 1))</span><br><span class="line">g</span><br><span class="line">scm&gt; (g 3)</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<p>Your implementation should do the following:</p>
<ul>
<li>Using the given variables <code>signature</code> and <code>expressions</code>, find the defined function’s name (symbol), formals, and body.</li>
<li>Create a <code>LambdaProcedure</code> instance using the formals and body. Hint: You can use what you’ve done in Problem 8 and call <code>do_lambda_form</code> on the appropriate arguments.</li>
<li>Bind the symbol to this new <code>LambdaProcedure</code> instance.</li>
</ul>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 10 -u</span><br><span class="line">python3 ok -q 10</span><br></pre></td></tr></table></figure>
<h3 id="Problem-11-1-pt-2">Problem 11 (1 pt)</h3>
<p>All of the Scheme procedures we’ve seen so far use <em>lexical scoping</em>: the parent of the new call frame is the environment in which the procedure was <strong>defined</strong>. Another type of scoping, which is not standard in Scheme but appears in other variants of Lisp, is called <em>dynamic scoping</em>: the parent of the new call frame is the environment in which the call expression was <strong>evaluated</strong>. With dynamic scoping, calling the same procedure with the same arguments from different parts of your code can create different behavior (due to different parent frames).</p>
<p>The <code>mu</code> special form (<a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#mu">spec</a>; invented for this project) evaluates to a dynamically scoped procedure.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (define f (mu () (* a b)))</span><br><span class="line">f</span><br><span class="line">scm&gt; (define g (lambda () (define a 4) (define b 5) (f)))</span><br><span class="line">g</span><br><span class="line">scm&gt; (g)</span><br><span class="line">20</span><br></pre></td></tr></table></figure>
<p>Above, the procedure <code>f</code> does not have <code>a</code> or <code>b</code> as arguments; however, because <code>f</code> gets called within the procedure <code>g</code>, it has access to the <code>a</code> and <code>b</code> defined in <code>g</code>’s frame.</p>
<p>Implement <code>do_mu_form</code> in <code>scheme_forms.py</code> to evaluate the <code>mu</code> special form. A <code>mu</code> expression evaluates to a <code>MuProcedure</code>. Most of the <code>MuProcedure</code> class (defined in <code>scheme_classes.py</code>) has been provided for you.</p>
<p>In addition to implementing <code>do_mu_form</code>, complete the <code>MuProcedure</code> case within the <code>scheme_apply</code> function (in <code>scheme_eval_apply.py</code>) so that when a mu procedure is called, its body is evaluated in the correct environment. When a <code>MuProcedure</code> is called, the parent of the new call frame is the environment in which that call expression was <strong>evaluated</strong>. As a result, a <code>MuProcedure</code> does not need to store an environment as an instance attribute.</p>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 11 -u</span><br><span class="line">python3 ok -q 11</span><br></pre></td></tr></table></figure>
<p>At this point in the project, your Scheme interpreter should support the following features:</p>
<ul>
<li>Creating procedures using <code>lambda</code> and <code>mu</code> expressions,</li>
<li>Defining named procedures using <code>define</code> expressions, and</li>
<li>Calling user-defined procedures.</li>
</ul>
<h2 id="Part-3-Special-Forms">Part 3: Special Forms</h2>
<p>This section will be completed in <code>scheme_forms.py</code>.</p>
<p>Logical special forms include <code>if</code>, <code>and</code>, <code>or</code>, and <code>cond</code>. These expressions are special because not all of their sub-expressions may be evaluated.</p>
<p>In Scheme, only <code>#f</code> is a false value. All other values (including <code>0</code> and <code>nil</code>) are true values. You can test whether a value is a true or false value using the provided Python functions <code>is_scheme_true</code> and <code>is_scheme_false</code>, defined in <code>scheme_utils.py</code>.</p>
<blockquote>
<p>Scheme traditionally uses <code>#f</code> to indicate the false Boolean value. In our interpreter, that is equivalent to <code>false</code> or <code>False</code>. Similarly, <code>true</code>, <code>True</code>, and <code>#t</code> are all equivalent. However, when unlocking tests, use <code>#t</code> and <code>#f</code>.</p>
</blockquote>
<p>To get you started, we’ve provided an implementation of the <code>if</code> special form in the <code>do_if_form</code> function. Make sure you understand that implementation before starting the following questions.</p>
<h3 id="Problem-12-2-pt">Problem 12 (2 pt)</h3>
<p>Implement <code>do_and_form</code> and <code>do_or_form</code> so that <code>and</code> and <code>or</code> expressions (<a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#and">spec</a>) are evaluated correctly.</p>
<p>The logical forms <code>and</code> and <code>or</code> are <em>short-circuiting</em>. For <code>and</code>, your interpreter should evaluate each sub-expression from left to right, and if any of these is a false value, return that value. Otherwise, return the value of the last sub-expression. If there are no sub-expressions in an <code>and</code> expression, it evaluates to <code>#t</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (and)</span><br><span class="line">#t</span><br><span class="line">scm&gt; (and 4 5 6)  ; all operands are true values</span><br><span class="line">6</span><br><span class="line">scm&gt; (and 4 5 (+ 3 3))</span><br><span class="line">6</span><br><span class="line">scm&gt; (and #t #f 42 (/ 1 0))  ; short-circuiting behavior of and</span><br><span class="line">#f</span><br></pre></td></tr></table></figure>
<blockquote>
<p>For the <code>and</code> and <code>or</code> forms, remember to use our internal Python representations of <code>#t</code> and <code>#f</code>. See <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/lab/lab11/#internal-representations">internal representations</a> from Lab 11.</p>
</blockquote>
<p>For <code>or</code>, evaluate each sub-expression from left to right. If any sub-expression evaluates to a true value, return that value. Otherwise, return the value of the last sub-expression. If there are no sub-expressions in an <code>or</code> expression, it evaluates to <code>#f</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (or)</span><br><span class="line">#f</span><br><span class="line">scm&gt; (or 5 2 1)  ; 5 is a true value</span><br><span class="line">5</span><br><span class="line">scm&gt; (or #f (- 1 1) 1)  ; 0 is a true value in Scheme</span><br><span class="line">0</span><br><span class="line">scm&gt; (or 4 #t (/ 1 0))  ; short-circuiting behavior of or</span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Important:</strong> Use the provided Python functions <code>is_scheme_true</code> and <code>is_scheme_false</code> from <code>scheme_utils.py</code> to test boolean values.</p>
</blockquote>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 12 -u</span><br><span class="line">python3 ok -q 12</span><br></pre></td></tr></table></figure>
<h3 id="Problem-13-2-pt">Problem 13 (2 pt)</h3>
<p>Fill in the missing parts of <code>do_cond_form</code> so that it correctly implements <code>cond</code> (<a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#cond">spec</a>), returning the value of the first result sub-expression corresponding to a true predicate, or the result sub-expression corresponding to <code>else</code>.</p>
<p>Some special cases:</p>
<ul>
<li>When the true predicate does not have a corresponding result sub-expression, return the predicate value.</li>
<li>When a result sub-expression of a <code>cond</code> case has multiple expressions, evaluate them all and return the value of the last expression. (<em>Hint:</em> Use <code>eval_all</code>.)</li>
</ul>
<p>Your implementation should match the following examples and the additional tests in <code>tests.scm</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (cond ((= 4 3) &#x27;nope)</span><br><span class="line">           ((= 4 4) &#x27;hi)</span><br><span class="line">           (else &#x27;wait))</span><br><span class="line">hi</span><br><span class="line">scm&gt; (cond ((= 4 3) &#x27;wat)</span><br><span class="line">           ((= 4 4))</span><br><span class="line">           (else &#x27;hm))</span><br><span class="line">#t</span><br><span class="line">scm&gt; (cond ((= 4 4) &#x27;here (+ 40 2))</span><br><span class="line">           (else &#x27;wat 0))</span><br><span class="line">42</span><br></pre></td></tr></table></figure>
<p>The value of a <code>cond</code> is <code>undefined</code> if there are no true predicates and no <code>else</code>. In such a case, <code>do_cond_form</code> should return <code>None</code>. If there is only an <code>else</code>, return its sub-expression. If it doesn’t have one, return <code>#t</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (cond (False 1) (False 2))</span><br><span class="line">scm&gt; (cond (else))</span><br><span class="line">#t</span><br></pre></td></tr></table></figure>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 13 -u</span><br><span class="line">python3 ok -q 13</span><br></pre></td></tr></table></figure>
<h3 id="Problem-14-2-pt">Problem 14 (2 pt)</h3>
<p>The <code>let</code> special form (<a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#let">spec</a>) binds symbols to values locally, giving them their initial values. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (define x 5)</span><br><span class="line">x</span><br><span class="line">scm&gt; (define y &#x27;bye)</span><br><span class="line">y</span><br><span class="line">scm&gt; (let ((x 42)</span><br><span class="line">           (y (* x 10)))  ; this x refers to the global value of x, not 42</span><br><span class="line">       (list x y))</span><br><span class="line">(42 50)</span><br><span class="line">scm&gt; (list x y)</span><br><span class="line">(5 bye)</span><br></pre></td></tr></table></figure>
<p>Implement <code>make_let_frame</code> in <code>scheme_forms.py</code>, which returns a child frame of <code>env</code> that binds the symbol in each element of <code>bindings</code> to the value of its corresponding expression. The <code>bindings</code> Scheme list contains pairs that each contain a symbol and a corresponding expression.</p>
<p>You may find the following functions and methods useful:</p>
<ul>
<li><code>validate_form</code>: this function can be used to validate the structure of each binding. It takes in a Scheme list <code>expr</code> of expressions and a <code>min</code> and <code>max</code> length. If <code>expr</code> is not a list with length between <code>min</code> and <code>max</code> inclusive, it raises an error. If no <code>max</code> is passed in, the default is infinity.</li>
<li><code>validate_formals</code>: this function validates that its argument is a Scheme list of symbols for which each symbol is distinct.</li>
</ul>
<p>Remember to refer to the <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-spec/#let">spec</a> if you don’t understand any of the test cases!</p>
<p>Use Ok to unlock and test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 14 -u</span><br><span class="line">python3 ok -q 14</span><br></pre></td></tr></table></figure>
<h3 id="Additional-Scheme-Tests-1-pt">Additional Scheme Tests (1 pt)</h3>
<p>Your final task in Part III of this project is to make sure that your scheme interpreter passes the additional suite of tests we have provided.</p>
<p>To run these tests (worth 1 point), run the command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q tests.scm</span><br></pre></td></tr></table></figure>
<p>If you have passed all of the required cases, you should see 1/1 points received for <code>tests.scm</code> when you run <code>python ok --score</code>. If you are failing tests due to output from <code>print</code> statements you’ve added in your code for debugging, make sure to remove those as well for the tests to pass.</p>
<blockquote>
<p>One you have completed Part III, make sure you submit using OK to receive full credit for the checkpoint.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok --submit</span><br></pre></td></tr></table></figure>
<p>If you’d like to check your score so far, use the following command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok --score</span><br></pre></td></tr></table></figure>
<p><strong>The best way to see what tests you’ve passed for the checkpoint is to use the score command in ok.</strong></p>
</blockquote>
<p>Congratulations! Your Scheme interpreter implementation is now complete!</p>
<h2 id="Part-IV-Write-Some-Scheme">Part IV: Write Some Scheme</h2>
<p>Not only is your Scheme interpreter itself a tree-recursive program, but it is flexible enough to evaluate other recursive programs. Implement the following procedures in the <code>questions.scm</code> file.</p>
<p>See the <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/scheme-builtins/">built-in procedure reference</a> for descriptions of the behavior of all built-in Scheme procedure.</p>
<p>As you use your interpreter, you may discover additional bugs in your interpreter implementation. Therefore, you may find it useful to test your code for these questions in the staff interpreter or the <a target="_blank" rel="noopener" href="https://code.cs61a.org/scheme">web editor</a> and then try it in your own interpreter once you are confident your Scheme code is working. You can also use the web editor to visualize the scheme code you’ve written and help you debug.</p>
<h3 id="Scheme-Editor-3">Scheme Editor</h3>
<p>As you’re writing your code, you can debug using the Scheme Editor. In your <code>scheme</code> folder you will find a new editor. To run this editor, run <code>python3 editor</code>. This should pop up a window in your browser; if it does not, please navigate to <a href="localhost:31415">localhost:31415</a> and you should see it.</p>
<p>Make sure to run <code>python3 ok</code> in a separate tab or window so that the editor keeps running.</p>
<p>👩🏽‍💻👨🏿‍💻 <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/articles/pair-programming">Pair programming?</a> Remember to alternate between driver and navigator roles. The driver controls the keyboard; the navigator watches, asks questions, and suggests ideas.</p>
<h3 id="Problem-15-2-pt">Problem 15 (2 pt)</h3>
<p>Implement the <code>enumerate</code> procedure, which takes in a list of values and returns a list of two-element lists, where the first element is the index of the value, and the second element is the value itself.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (enumerate &#x27;(3 4 5 6))</span><br><span class="line">((0 3) (1 4) (2 5) (3 6))</span><br><span class="line">scm&gt; (enumerate &#x27;())</span><br><span class="line">()</span><br></pre></td></tr></table></figure>
<p>Use Ok to test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 15</span><br></pre></td></tr></table></figure>
<h3 id="Problem-16-2-pt">Problem 16 (2 pt)</h3>
<p>Implement the <code>merge</code> procedure, which takes in a comparator function <code>inorder?</code> and two lists that are sorted, and combines the two lists into a single sorted list. A comparator defines an ordering by comparing two values and returning a true value if and only if the two values are ordered. Here, sorted means sorted according to the comparator. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (merge &lt; &#x27;(1 4 6) &#x27;(2 5 8))</span><br><span class="line">(1 2 4 5 6 8)</span><br><span class="line">scm&gt; (merge &gt; &#x27;(6 4 1) &#x27;(8 5 2))</span><br><span class="line">(8 6 5 4 2 1)</span><br></pre></td></tr></table></figure>
<p>In case of a tie, you can choose to break the tie arbitrarily.</p>
<p>Use Ok to test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q 16</span><br></pre></td></tr></table></figure>
<h2 id="Extra-Credit">Extra Credit</h2>
<blockquote>
<p>During regular Office Hours and Project Parties, the staff will prioritize helping students with required questions. We will not be offering help with either extra credit problems unless the <a target="_blank" rel="noopener" href="https://oh.cs61a.org/">queue</a> is empty.</p>
</blockquote>
<h3 id="Problem-EC-1-2-pt">Problem EC 1 (2 pt)</h3>
<p>Complete the function <code>optimize_tail_calls</code> in <code>scheme_eval_apply.py</code>. It returns an alternative to <code>scheme_eval</code> that is properly tail recursive. That is, the interpreter will allow an unbounded number of active tail calls in constant space. It has a third argument <code>tail</code> that indicates whether the expression to be evaluated is in a tail context.</p>
<p>The <code>Unevaluated</code> class represents an expression that needs to be evaluated in an environment. When <code>optimized_eval</code> receives a non-atomic expression in a tail context, it returns an <code>Unevaluated</code> instance. Otherwise, it should repeatedly call <code>unoptimized_scheme_eval</code> until the result is a value, rather than an <code>Unevaluated</code>.</p>
<p><strong>A successful implementation will require changes to several other functions, including some functions that we provided for you.</strong> All expressions throughout your interpreter that are in a tail context should be evaluated by calling <code>scheme_eval</code> with <code>True</code> as the third argument (now called <code>tail</code>). Your goal is to determine which expressions are in a tail context throughout your code and change calls to <code>scheme_eval</code> as needed.</p>
<blockquote>
<p>Tail call optimization was discussed in <a target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs61a/sp22/assets/slides/29-Scopes_+_Tail_Calls.html">Lecture 29</a>. The Unevaluated class in the Scheme interpreter is similar conceptually to the “thunk” discussed in lecture, and the missing code in optimized_eval is basically the “trampolining” technique discussed in lecture.</p>
</blockquote>
<p>Once you finish, uncomment the following line in <code>scheme_eval_apply.py</code> to use your implementation:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scheme_eval = optimize_tail_calls(scheme_eval)</span><br></pre></td></tr></table></figure>
<p>Use Ok to test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q EC</span><br></pre></td></tr></table></figure>
<h2 id="Optional-Problems-2">Optional Problems</h2>
<h3 id="Optional-Problem-1-0-pt">Optional Problem 1 (0 pt)</h3>
<p>In Scheme, source code is data. Every non-atomic expression is written as a Scheme list, so we can write procedures that manipulate other programs just as we write procedures that manipulate lists.</p>
<p>Rewriting programs can be useful: we can write an interpreter that only handles a small core of the language, and then write a procedure that converts other special forms into the core language before a program is passed to the interpreter.</p>
<p>For example, the <code>let</code> special form is equivalent to a call expression that begins with a <code>lambda</code> expression. Both create a new frame extending the current environment and evaluate a body within that new environment.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(let ((a 1) (b 2)) (+ a b))</span><br><span class="line">;; Is equivalent to:</span><br><span class="line">((lambda (a b) (+ a b)) 1 2)</span><br></pre></td></tr></table></figure>
<p>These expressions can be represented by the following diagrams:</p>
<table>
<thead>
<tr>
<th>Let</th>
<th>Lambda</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="/CS61A-Spring2022/projects/project4/images/let.png" alt=""></td>
<td><img src="/CS61A-Spring2022/projects/project4/images/lambda.png" alt=""></td>
</tr>
</tbody>
</table>
<p>Use this rule to implement a procedure called <code>let-to-lambda</code> that rewrites all <code>let</code> special forms into <code>lambda</code> expressions. If we quote a <code>let</code> expression and pass it into this procedure, an equivalent <code>lambda</code> expression should be returned:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (let-to-lambda &#x27;(let ((a 1) (b 2)) (+ a b)))</span><br><span class="line">((lambda (a b) (+ a b)) 1 2)</span><br><span class="line">scm&gt; (let-to-lambda &#x27;(let ((a 1)) (let ((b a)) b)))</span><br><span class="line">((lambda (a) ((lambda (b) b) a)) 1)</span><br><span class="line">scm&gt; (let-to-lambda 1)</span><br><span class="line">1</span><br><span class="line">scm&gt; (let-to-lambda &#x27;a)</span><br><span class="line">a</span><br></pre></td></tr></table></figure>
<p>In order to handle all programs, <code>let-to-lambda</code> must be aware of Scheme syntax. Since Scheme expressions are recursively nested, <code>let-to-lambda</code> must also be recursive. In fact, the structure of <code>let-to-lambda</code> is somewhat similar to that of <code>scheme_eval</code>–but in Scheme! As a reminder, atoms include numbers, booleans, nil, and symbols. You do not need to consider code that contains quasiquotation for this problem.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(define (let-to-lambda expr)</span><br><span class="line">  (cond ((atom?   expr) &lt;rewrite atoms&gt;)</span><br><span class="line">        ((quoted? expr) &lt;rewrite quoted expressions&gt;)</span><br><span class="line">        ((lambda? expr) &lt;rewrite lambda expressions&gt;)</span><br><span class="line">        ((define? expr) &lt;rewrite define expressions&gt;)</span><br><span class="line">        ((let?    expr) &lt;rewrite let expressions&gt;)</span><br><span class="line">        (else           &lt;rewrite other expressions&gt;)))</span><br></pre></td></tr></table></figure>
<p><em>Hint:</em> Consider how you can use <code>map</code> to convert <code>let</code> forms in every element of a list to the equivalent <code>lambda</code> form.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (zip &#x27;((1 2) (3 4) (5 6)))</span><br><span class="line">((1 3 5) (2 4 6))</span><br><span class="line">scm&gt; (zip &#x27;((1 2)))</span><br><span class="line">((1) (2))</span><br><span class="line">scm&gt; (zip &#x27;())</span><br><span class="line">(() ())</span><br></pre></td></tr></table></figure>
<p><em>Hint 2:</em> In this problem, it may be helpful to build a scheme list that evaluates to a special form (for instance, a <code>lambda</code> expression). As a related example, the following code builds a scheme list that evaluates to the expression <code>(define (f x) (+ x 1))</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(let ((name-and-params &#x27;(f x))</span><br><span class="line">      (body &#x27;(+ x 1)))</span><br><span class="line">  (cons &#x27;define</span><br><span class="line">        (cons name-and-params (cons body nil))))</span><br></pre></td></tr></table></figure>
<p>Test your implementation by running</p>
<p>Use Ok to test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q optional_1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>We used <code>let</code> while defining <code>let-to-lambda</code>. What if we want to run <code>let-to-lambda</code> on an interpreter that does not recognize <code>let</code>? We can pass <code>let-to-lambda</code> to itself to rewrite itself into an <em>equivalent program without</em> <code>let</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">;; The let-to-lambda procedure</span><br><span class="line">(define (let-to-lambda expr)</span><br><span class="line"> ...)</span><br><span class="line"></span><br><span class="line">;; A list representing the let-to-lambda procedure</span><br><span class="line">(define let-to-lambda-code</span><br><span class="line">  &#x27;(define (let-to-lambda expr)</span><br><span class="line">     ...))</span><br><span class="line"></span><br><span class="line">;; A let-to-lambda procedure that does not use &#x27;let&#x27;!</span><br><span class="line">(define let-to-lambda-without-let</span><br><span class="line">  (let-to-lambda let-to-lambda-code))</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Optional-Problem-2-0-pt">Optional Problem 2 (0 pt)</h2>
<p>Macros allow the language itself to be extended by the user. Simple macros can be provided with the <code>define-macro</code> special form. This must be used like a procedure definition, and it creates a procedure just like <code>define</code>. However, this procedure has a special evaluation rule: it is applied to its arguments without first evaluating them. Then the result of this application is evaluated.</p>
<p>This final evaluation step takes place in the caller’s frame, as if the return value from the macro was literally pasted into the code in place of the macro.</p>
<p>Here is a simple example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scm&gt; (define (map f lst) (if (null? lst) nil (cons (f (car lst)) (map f (cdr lst)))))</span><br><span class="line">scm&gt; (define-macro (for formal iterable body)</span><br><span class="line">....     (list &#x27;map (list &#x27;lambda (list formal) body) iterable))</span><br><span class="line">scm&gt; (for i &#x27;(1 2 3)</span><br><span class="line">....     (print (* i i)))</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">9</span><br><span class="line">(None None None)</span><br></pre></td></tr></table></figure>
<p>The code above defines a macro <code>for</code> that acts as a <code>map</code> except that it doesn’t need a lambda around the body.</p>
<p>In order to implement <code>define-macro</code>, complete the implementation for <code>do_define_macro</code>, which should create a <code>MacroProcedure</code> and bind it to the given name as in <code>do_define_form</code>. Then, update <code>scheme_eval</code> so that calls to macro procedures are evaluated correctly.</p>
<p>Use Ok to test your code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok -q optional_2</span><br></pre></td></tr></table></figure>
<h3 id="Conclusion">Conclusion</h3>
<p><strong>Congratulations!</strong> You have just implemented an interpreter for an entire language! If you enjoyed this project and want to extend it further, you may be interested in looking at more advanced features, like <a target="_blank" rel="noopener" href="http://schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-7.html#%25_sec_4.2.2">let* and letrec</a>, <a target="_blank" rel="noopener" href="http://schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-7.html#%25_sec_4.2.6">unquote splicing</a>, <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Stack_trace">error tracing</a>, and <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Call-with-current-continuation">continuations</a>.</p>
<p>Submit to Ok to complete the project.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ok --submit</span><br></pre></td></tr></table></figure>
<p>If you have a partner, make sure to add them to the submission on <a target="_blank" rel="noopener" href="http://okpy.org">okpy.org</a>.</p>
<h2 id="Project-4-Solution">Project 4 Solution</h2>
<h2 id="Part-1-The-Evaluator-2">Part 1: The Evaluator</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q eval_apply -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Understanding Eval/Apply &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">Q: What types of expressions are represented as Pairs?</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) All expressions are represented as Pairs</span><br><span class="line">1) Only call expressions</span><br><span class="line">2) Call expressions and special forms</span><br><span class="line">3) Only special forms</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Understanding Eval/Apply &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">Q: What expression in the body of scheme_eval finds the value of a name?</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) scheme_forms.SPECIAL_FORMS[first](rest, env)</span><br><span class="line">1) scheme_symbolp(expr)</span><br><span class="line">2) env.lookup(expr)</span><br><span class="line">3) env.find(name)</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Understanding Eval/Apply &gt; Suite 1 &gt; Case 3</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">Q: How do we know if a given combination is a special form?</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) Check if the first element in the list is a symbol</span><br><span class="line">1) Check if the first element in the list is a symbol and that the</span><br><span class="line">   symbol is in the dictionary SPECIAL_FORMS</span><br><span class="line">2) Check if the expression is in the dictionary SPECIAL_FORMS</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Understanding Eval/Apply &gt; Suite 1 &gt; Case 4</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">Q: What is the difference between applying builtins and applying user-defined procedures?</span><br><span class="line">(Choose all that apply)</span><br><span class="line"></span><br><span class="line">I.   User-defined procedures open a new frame; builtins do not</span><br><span class="line">II.  Builtins simply execute a predefined function; user-defined</span><br><span class="line">     procedures must evaluate additional expressions in the body</span><br><span class="line">III. Builtins have a fixed number of arguments; user-defined procedures do not</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) III only</span><br><span class="line">1) II only</span><br><span class="line">2) I only</span><br><span class="line">3) I, II and III</span><br><span class="line">4) I and II</span><br><span class="line">5) I and III</span><br><span class="line">6) II and III</span><br><span class="line">? 4</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Understanding Eval/Apply &gt; Suite 1 &gt; Case 5</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">Q: What exception should be raised for the expression (1)?</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) SchemeError(&quot;malformed list: (1)&quot;)</span><br><span class="line">1) AssertionError</span><br><span class="line">2) SchemeError(&quot;unknown identifier: 1&quot;)</span><br><span class="line">3) SchemeError(&quot;1 is not callable&quot;)</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Understanding Eval/Apply unlocked.</span><br></pre></td></tr></table></figure>
<h2 id="Problem-1-1-pt-4">Problem 1 (1 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 01 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 1 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; global_frame = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; global_frame.define(&quot;x&quot;, 3)</span><br><span class="line">&gt;&gt;&gt; global_frame.parent is None</span><br><span class="line">? True</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; global_frame.lookup(&quot;x&quot;)</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; global_frame.define(&quot;x&quot;, 2)</span><br><span class="line">&gt;&gt;&gt; global_frame.lookup(&quot;x&quot;)</span><br><span class="line">? 3</span><br><span class="line">-- Not quite. Try again! --</span><br><span class="line"></span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; global_frame.lookup(&quot;foo&quot;)</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) SchemeError</span><br><span class="line">1) 3</span><br><span class="line">2) None</span><br><span class="line">? 0</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 1 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; first_frame = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; first_frame.define(&quot;x&quot;, 3)</span><br><span class="line">&gt;&gt;&gt; second_frame = Frame(first_frame)</span><br><span class="line">&gt;&gt;&gt; second_frame.parent == first_frame</span><br><span class="line">? True</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; second_frame.define(&quot;y&quot;, False)</span><br><span class="line">&gt;&gt;&gt; second_frame.lookup(&quot;x&quot;)</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; second_frame.lookup(&quot;y&quot;)</span><br><span class="line">? False</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 1 &gt; Suite 1 &gt; Case 3</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 1 &gt; Suite 1 &gt; Case 4</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 1 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 1 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_classes.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def define(self, symbol, value):</span><br><span class="line">        &quot;&quot;&quot;Define Scheme SYMBOL to have VALUE.&quot;&quot;&quot;</span><br><span class="line">        # BEGIN PROBLEM 1</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        self.bindings[symbol] = value</span><br><span class="line">        # END PROBLEM 1</span><br><span class="line"></span><br><span class="line">def lookup(self, symbol):</span><br><span class="line">    &quot;&quot;&quot;Return the value bound to SYMBOL. Errors if SYMBOL is not found.&quot;&quot;&quot;</span><br><span class="line">    # BEGIN PROBLEM 1</span><br><span class="line">    &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">    if symbol in self.bindings.keys():</span><br><span class="line">        return self.bindings[symbol]</span><br><span class="line">    elif self.parent is not None:</span><br><span class="line">        return self.parent.lookup(symbol)`</span><br><span class="line">    # END PROBLEM 1</span><br><span class="line">    raise SchemeError(&#x27;unknown identifier: &#123;0&#125;&#x27;.format(symbol))</span><br></pre></td></tr></table></figure>
<h2 id="Problem-2-2-pt-2">Problem 2 (2 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 02 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 2 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 9)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; twos = Pair(2, Pair(2, nil))</span><br><span class="line">&gt;&gt;&gt; plus = BuiltinProcedure(scheme_add) # + procedure</span><br><span class="line">&gt;&gt;&gt; scheme_apply(plus, twos, env) # Type SchemeError if you think this errors</span><br><span class="line">? 4</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 2 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 8)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; plus = BuiltinProcedure(scheme_add) # + procedure</span><br><span class="line">&gt;&gt;&gt; scheme_apply(plus, nil, env) # Remember what (+) evaluates to in scheme</span><br><span class="line">? 0</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 2 &gt; Suite 1 &gt; Case 3</span><br><span class="line">(cases remaining: 7)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; twos = Pair(2, Pair(2, nil))</span><br><span class="line">&gt;&gt;&gt; oddp = BuiltinProcedure(scheme_oddp) # odd? procedure</span><br><span class="line">&gt;&gt;&gt; scheme_apply(oddp, twos, env) # Type SchemeError if you think this errors</span><br><span class="line">? SchemeError</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 2 &gt; Suite 1 &gt; Case 4</span><br><span class="line">(cases remaining: 6)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 2 &gt; Suite 1 &gt; Case 5</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 2 &gt; Suite 1 &gt; Case 6</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 2 &gt; Suite 1 &gt; Case 7</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 2 &gt; Suite 1 &gt; Case 8</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 2 &gt; Suite 1 &gt; Case 9</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 2 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_eval_apply.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">def scheme_apply(procedure, args, env):</span><br><span class="line">    &quot;&quot;&quot;Apply Scheme PROCEDURE to argument values ARGS (a Scheme list) in</span><br><span class="line">    Frame ENV, the current environment.&quot;&quot;&quot;</span><br><span class="line">    validate_procedure(procedure)</span><br><span class="line">    if isinstance(procedure, BuiltinProcedure):</span><br><span class="line">        # BEGIN PROBLEM 2</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        args_list = pair_to_list(args)</span><br><span class="line">        if procedure.expect_env:</span><br><span class="line">            args_list.append(env)</span><br><span class="line">        try:</span><br><span class="line">            return procedure.py_func(*args_list)</span><br><span class="line">        except TypeError:</span><br><span class="line">            raise SchemeError(&#x27;incorrect number of arguments&#x27;)</span><br><span class="line">        # END PROBLEM 2</span><br><span class="line">    elif isinstance(procedure, LambdaProcedure):</span><br><span class="line">        # BEGIN PROBLEM 9</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        # END PROBLEM 9</span><br><span class="line">    elif isinstance(procedure, MuProcedure):</span><br><span class="line">        # BEGIN PROBLEM 11</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        # END PROBLEM 11</span><br><span class="line">    else:</span><br><span class="line">        assert False, &quot;Unexpected procedure: &#123;&#125;&quot;.format(procedure)</span><br></pre></td></tr></table></figure>
<h2 id="Problem-3-2-pt-3">Problem 3 (2 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 03 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 3 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme_reader import *</span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; expr = read_line(&#x27;(+ 2 2)&#x27;)</span><br><span class="line">&gt;&gt;&gt; scheme_eval(expr, create_global_frame()) # Type SchemeError if you think this errors</span><br><span class="line">? 4</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; scheme_eval(Pair(&#x27;+&#x27;, Pair(2, Pair(2, nil))), create_global_frame()) # Type SchemeError if you think this errors</span><br><span class="line">? 4</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; expr = read_line(&#x27;(+ (+ 2 2) (+ 1 3) (* 1 4))&#x27;)</span><br><span class="line">&gt;&gt;&gt; scheme_eval(expr, create_global_frame()) # Type SchemeError if you think this errors</span><br><span class="line">? 12</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; expr = read_line(&#x27;(yolo)&#x27;)</span><br><span class="line">&gt;&gt;&gt; scheme_eval(expr, create_global_frame()) # Type SchemeError if you think this errors</span><br><span class="line">? SchemeError</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 3 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (* (+ 3 2) (+ 1 7)) ; Type SchemeError if you think this errors</span><br><span class="line">? 40</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (1 2) ; Type SchemeError if you think this errors</span><br><span class="line">? SchemeError</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (1 (print 0)) ; validate_procedure should be called before operands are evaluated</span><br><span class="line">? SchemeError</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 3 &gt; Suite 2 &gt; Case 2</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 3 &gt; Suite 2 &gt; Case 3</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 3 &gt; Suite 2 &gt; Case 4</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 3 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_eval_apply.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">def scheme_eval(expr, env, _=None):  # Optional third argument is ignored</span><br><span class="line">    &quot;&quot;&quot;Evaluate Scheme expression EXPR in Frame ENV.</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; expr = read_line(&#x27;(+ 2 2)&#x27;)</span><br><span class="line">    &gt;&gt;&gt; expr</span><br><span class="line">    Pair(&#x27;+&#x27;, Pair(2, Pair(2, nil)))</span><br><span class="line">    &gt;&gt;&gt; scheme_eval(expr, create_global_frame())</span><br><span class="line">    4</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # Evaluate atoms</span><br><span class="line">    if scheme_symbolp(expr):</span><br><span class="line">        return env.lookup(expr)</span><br><span class="line">    elif self_evaluating(expr):</span><br><span class="line">        return expr</span><br><span class="line"></span><br><span class="line">    # All non-atomic expressions are lists (combinations)</span><br><span class="line">    if not scheme_listp(expr):</span><br><span class="line">        raise SchemeError(&#x27;malformed list: &#123;0&#125;&#x27;.format(repl_str(expr)))</span><br><span class="line">    first, rest = expr.first, expr.rest</span><br><span class="line">    if scheme_symbolp(first) and first in scheme_forms.SPECIAL_FORMS:</span><br><span class="line">        return scheme_forms.SPECIAL_FORMS[first](rest, env)</span><br><span class="line">    else:</span><br><span class="line">        # BEGIN PROBLEM 3</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        procedure = scheme_eval(first, env)</span><br><span class="line">        args = rest.map(lambda operand: scheme_eval(operand, env))</span><br><span class="line">        return scheme_apply(procedure, args, env)</span><br><span class="line">        # END PROBLEM 3</span><br><span class="line"></span><br><span class="line">def pair_to_list(pair):</span><br><span class="line">    if pair is nil:</span><br><span class="line">        return []</span><br><span class="line">    else:</span><br><span class="line">        return [pair.first] + pair_to_list(pair.rest)</span><br></pre></td></tr></table></figure>
<h2 id="Problem-4-2-pt-3">Problem 4 (2 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 04 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 4 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 9)</span><br><span class="line"></span><br><span class="line">Q: What is the structure of the expressions argument to do_define_form?</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) Pair(A, B), where:</span><br><span class="line">       A is the symbol being bound,</span><br><span class="line">       B is an expression whose value should be evaluated and bound to A</span><br><span class="line">1) Pair(&#x27;define&#x27;, Pair(A, Pair(B, nil))), where:</span><br><span class="line">       A is the symbol being bound,</span><br><span class="line">       B is an expression whose value should be evaluated and bound to A</span><br><span class="line">2) Pair(A, Pair(B, nil)), where:</span><br><span class="line">       A is the symbol being bound,</span><br><span class="line">       B is an expression whose value should be evaluated and bound to A</span><br><span class="line">3) Pair(A, Pair(B, nil)), where:</span><br><span class="line">       A is the symbol being bound,</span><br><span class="line">       B is the value that should be bound to A</span><br><span class="line">4) Pair(A, B), where:</span><br><span class="line">       A is the symbol being bound,</span><br><span class="line">       B is the value that should be bound to A</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 4 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 8)</span><br><span class="line"></span><br><span class="line">Q: What method of a Frame instance will bind</span><br><span class="line">a value to a symbol in that frame?</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) bindings</span><br><span class="line">1) define</span><br><span class="line">2) lookup</span><br><span class="line">3) make_child_frame</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 4 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 7)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (define size 2)</span><br><span class="line">? size</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; size</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 4 &gt; Suite 2 &gt; Case 2</span><br><span class="line">(cases remaining: 6)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (define x (+ 2 3))</span><br><span class="line">? x</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; x</span><br><span class="line">? 5</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (define x (+ 2 7))</span><br><span class="line">? x</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; x</span><br><span class="line">? 9</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (eval (define tau 6.28)) ; eval takes an expression represented as a list and evaluates it</span><br><span class="line">? 6.28</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 4 &gt; Suite 2 &gt; Case 3</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 4 &gt; Suite 2 &gt; Case 4</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 4 &gt; Suite 2 &gt; Case 5</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 4 &gt; Suite 2 &gt; Case 6</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (define x 15)</span><br><span class="line">? x</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (define y (* 2 x))</span><br><span class="line">? y</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; y</span><br><span class="line">? 30</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (+ y (* y 2) 1)</span><br><span class="line">? 91</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (define x 20)</span><br><span class="line">? x</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; x</span><br><span class="line">? 20</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 4 &gt; Suite 2 &gt; Case 7</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (define x 0)</span><br><span class="line">? x</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; ((define x (+ x 1)) 2)</span><br><span class="line">? SchemeError</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; x</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 4 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_forms.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">def do_define_form(expressions, env):</span><br><span class="line">    &quot;&quot;&quot;Evaluate a define form.</span><br><span class="line">    &gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">    &gt;&gt;&gt; do_define_form(read_line(&quot;(x 2)&quot;), env) # evaluating (define x 2)</span><br><span class="line">    &#x27;x&#x27;</span><br><span class="line">    &gt;&gt;&gt; scheme_eval(&quot;x&quot;, env)</span><br><span class="line">    2</span><br><span class="line">    &gt;&gt;&gt; do_define_form(read_line(&quot;(x (+ 2 8))&quot;), env) # evaluating (define x (+ 2 8))</span><br><span class="line">    &#x27;x&#x27;</span><br><span class="line">    &gt;&gt;&gt; scheme_eval(&quot;x&quot;, env)</span><br><span class="line">    10</span><br><span class="line">    &gt;&gt;&gt; # problem 10</span><br><span class="line">    &gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">    &gt;&gt;&gt; do_define_form(read_line(&quot;((f x) (+ x 2))&quot;), env) # evaluating (define (f x) (+ x 8))</span><br><span class="line">    &#x27;f&#x27;</span><br><span class="line">    &gt;&gt;&gt; scheme_eval(read_line(&quot;(f 3)&quot;), env)</span><br><span class="line">    5</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    validate_form(expressions, 2)  # Checks that expressions is a list of length at least 2</span><br><span class="line">    signature = expressions.first</span><br><span class="line">    if scheme_symbolp(signature):</span><br><span class="line">        # assigning a name to a value e.g. (define x (+ 1 2))</span><br><span class="line">        validate_form(expressions, 2, 2)  # Checks that expressions is a list of length exactly 2</span><br><span class="line">        # BEGIN PROBLEM 4</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        value = scheme_eval(expressions.rest.first, env)</span><br><span class="line">        env.define(signature, value)</span><br><span class="line">        return signature</span><br><span class="line">        # END PROBLEM 4</span><br><span class="line">    elif isinstance(signature, Pair) and scheme_symbolp(signature.first):</span><br><span class="line">        # defining a named procedure e.g. (define (f x y) (+ x y))</span><br><span class="line">        # BEGIN PROBLEM 10</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        # END PROBLEM 10</span><br><span class="line">    else:</span><br><span class="line">        bad_signature = signature.first if isinstance(signature, Pair) else signature</span><br><span class="line">        raise SchemeError(&#x27;non-symbol: &#123;0&#125;&#x27;.format(bad_signature))</span><br></pre></td></tr></table></figure>
<h2 id="Problem-5-1-pt-2">Problem 5 (1 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 05 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 5 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">Q: What is the structure of the expressions argument to do_quote_form?</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) A, where:</span><br><span class="line">       A is the quoted expression</span><br><span class="line">1) [A], where:</span><br><span class="line">       A is the quoted expression</span><br><span class="line">2) Pair(&#x27;quote&#x27;, Pair(A, nil)), where:</span><br><span class="line">       A is the quoted expression</span><br><span class="line">3) Pair(A, nil), where:</span><br><span class="line">       A is the quoted expression</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 5 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; global_frame = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; do_quote_form(Pair(3, nil), global_frame)</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; do_quote_form(Pair(&#x27;hi&#x27;, nil), global_frame)</span><br><span class="line">? &#x27;hi&#x27;</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; expr = Pair(Pair(&#x27;+&#x27;, Pair(&#x27;x&#x27;, Pair(2, nil))), nil)</span><br><span class="line">&gt;&gt;&gt; do_quote_form(expr, global_frame) # Make sure to use Pair notation</span><br><span class="line">? Pair(&#x27;+&#x27;, Pair(&#x27;x&#x27;, Pair(2, nil)))</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 5 &gt; Suite 3 &gt; Case 1</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; &#x27;&#x27;hello</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) (quote (quote (hello)))</span><br><span class="line">1) hello</span><br><span class="line">2) (hello)</span><br><span class="line">3) (quote hello)</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (quote (1 2))</span><br><span class="line">? (1 2)</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (car &#x27;(1 2 3))</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (cdr &#x27;(1 2))</span><br><span class="line">? (2)</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (cons &#x27;car &#x27;(&#x27;(4 2)))</span><br><span class="line">? (car (quote (4 2)))</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (eval (cons &#x27;car &#x27;(&#x27;(4 2))))</span><br><span class="line">? 4</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 5 &gt; Suite 4 &gt; Case 1</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 5 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_forms.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def do_quote_form(expressions, env):</span><br><span class="line">    &quot;&quot;&quot;Evaluate a quote form.</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">    &gt;&gt;&gt; do_quote_form(read_line(&quot;((+ x 2))&quot;), env) # evaluating (quote (+ x 2))</span><br><span class="line">    Pair(&#x27;+&#x27;, Pair(&#x27;x&#x27;, Pair(2, nil)))</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    validate_form(expressions, 1, 1)</span><br><span class="line">    # BEGIN PROBLEM 5</span><br><span class="line">    &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">    return expressions.first</span><br><span class="line">    # END PROBLEM 5</span><br></pre></td></tr></table></figure>
<h2 id="Problem-6-1-pt-3">Problem 6 (1 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 06 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 6 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 6)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; eval_all(Pair(2, nil), env)</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) SchemeError</span><br><span class="line">1) 2</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; eval_all(Pair(4, Pair(5, nil)), env)</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) 4</span><br><span class="line">1) 5</span><br><span class="line">2) (4 5)</span><br><span class="line">3) SchemeError</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; eval_all(nil, env) # return None (meaning undefined)</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 6 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; lst = Pair(1, Pair(2, Pair(3, nil)))</span><br><span class="line">&gt;&gt;&gt; eval_all(lst, env)</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; lst     # The list should not be mutated!</span><br><span class="line">? Pair(1, Pair(2, Pair(3, nil)))</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 6 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (begin (+ 2 3) (+ 5 6))</span><br><span class="line">? 11</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (begin (define x 3) x)</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 6 &gt; Suite 2 &gt; Case 2</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (begin 30 &#x27;(+ 2 2))</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) 4</span><br><span class="line">1) &#x27;(+ 2 2)</span><br><span class="line">2) 30</span><br><span class="line">3) (+ 2 2)</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (define x 0)</span><br><span class="line">? x</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (begin (define x (+ x 1)) 42 (define y (+ x 1)))</span><br><span class="line">? y</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; x</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; y</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 6 &gt; Suite 2 &gt; Case 3</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 6 &gt; Suite 2 &gt; Case 4</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 6 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_eval_apply.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">def eval_all(expressions, env):</span><br><span class="line">    &quot;&quot;&quot;Evaluate each expression in the Scheme list EXPRESSIONS in</span><br><span class="line">    Frame ENV (the current environment) and return the value of the last.</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; eval_all(read_line(&quot;(1)&quot;), create_global_frame())</span><br><span class="line">    1</span><br><span class="line">    &gt;&gt;&gt; eval_all(read_line(&quot;(1 2)&quot;), create_global_frame())</span><br><span class="line">    2</span><br><span class="line">    &gt;&gt;&gt; x = eval_all(read_line(&quot;((print 1) 2)&quot;), create_global_frame())</span><br><span class="line">    1</span><br><span class="line">    &gt;&gt;&gt; x</span><br><span class="line">    2</span><br><span class="line">    &gt;&gt;&gt; eval_all(read_line(&quot;((define x 2) x)&quot;), create_global_frame())</span><br><span class="line">    2</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # BEGIN PROBLEM 6</span><br><span class="line">    # return scheme_eval(expressions.first, env)  # replace this with lines of your own code</span><br><span class="line">    if expressions is nil:</span><br><span class="line">        return</span><br><span class="line">    expr = expressions</span><br><span class="line">    while expr.rest is not nil:</span><br><span class="line">        scheme_eval(expr.first, env)</span><br><span class="line">        expr = expr.rest</span><br><span class="line">    return scheme_eval(expr.first, env)</span><br><span class="line">    # END PROBLEM 6</span><br></pre></td></tr></table></figure>
<h2 id="Problem-7-2-pt-2">Problem 7 (2 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 07 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 7 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (lambda (x y) (+ x y))</span><br><span class="line">? (lambda (x y) (+ x y))</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (lambda (x)) ; type SchemeError if you think this causes an error</span><br><span class="line">? SchemeError</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 7 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 7 &gt; Suite 1 &gt; Case 3</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 7 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme_reader import *</span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; lambda_line = read_line(&quot;(lambda (a b c) (+ a b c))&quot;)</span><br><span class="line">&gt;&gt;&gt; lambda_proc = do_lambda_form(lambda_line.rest, env)</span><br><span class="line">&gt;&gt;&gt; lambda_proc.formals # use single quotes &#x27; around strings in your answer</span><br><span class="line">? Pair(&#x27;a&#x27;, Pair(&#x27;b&#x27;, Pair(&#x27;c&#x27;, nil)))</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; lambda_proc.body # the body is a *list* of expressions! Make sure your answer is a properly nested Pair.</span><br><span class="line">? Pair(Pair(&#x27;+&#x27;, Pair(&#x27;a&#x27;, Pair(&#x27;b&#x27;, Pair(&#x27;c&#x27;, nil)))), nil)</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 7 &gt; Suite 2 &gt; Case 2</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 7 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_forms.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def do_lambda_form(expressions, env):</span><br><span class="line">    &quot;&quot;&quot;Evaluate a lambda form.</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">    &gt;&gt;&gt; do_lambda_form(read_line(&quot;((x) (+ x 2))&quot;), env) # evaluating (lambda (x) (+ x 2))</span><br><span class="line">    LambdaProcedure(Pair(&#x27;x&#x27;, nil), Pair(Pair(&#x27;+&#x27;, Pair(&#x27;x&#x27;, Pair(2, nil))), nil), &lt;Global Frame&gt;)</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    validate_form(expressions, 2)</span><br><span class="line">    formals = expressions.first</span><br><span class="line">    validate_formals(formals)</span><br><span class="line">    # BEGIN PROBLEM 7</span><br><span class="line">    &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">    body = expressions.rest</span><br><span class="line">    return LambdaProcedure(formals, body, env)</span><br><span class="line">    # END PROBLEM 7</span><br></pre></td></tr></table></figure>
<h2 id="Problem-8-2-pt-2">Problem 8 (2 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 08 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 8 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 6)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; global_frame = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; formals = Pair(&#x27;a&#x27;, Pair(&#x27;b&#x27;, Pair(&#x27;c&#x27;, nil)))</span><br><span class="line">&gt;&gt;&gt; vals = Pair(1, Pair(2, Pair(3, nil)))</span><br><span class="line">&gt;&gt;&gt; frame = global_frame.make_child_frame(formals, vals)</span><br><span class="line">&gt;&gt;&gt; global_frame.lookup(&#x27;a&#x27;) # Type SchemeError if you think this errors</span><br><span class="line">? SchemeError</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; frame.lookup(&#x27;a&#x27;)        # Type SchemeError if you think this errors</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; frame.lookup(&#x27;b&#x27;)        # Type SchemeError if you think this errors</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; frame.lookup(&#x27;c&#x27;)        # Type SchemeError if you think this errors</span><br><span class="line">? 3</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 8 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from scheme import *</span><br><span class="line">&gt;&gt;&gt; global_frame = create_global_frame()</span><br><span class="line">&gt;&gt;&gt; frame = global_frame.make_child_frame(nil, nil)</span><br><span class="line">&gt;&gt;&gt; frame.parent is global_frame</span><br><span class="line">? True</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 8 &gt; Suite 1 &gt; Case 3</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 8 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 8 &gt; Suite 2 &gt; Case 2</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 8 &gt; Suite 2 &gt; Case 3</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 8 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_classes.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def make_child_frame(self, formals, vals):</span><br><span class="line">    &quot;&quot;&quot;Return a new local frame whose parent is SELF, in which the symbols</span><br><span class="line">    in a Scheme list of formal parameters FORMALS are bound to the Scheme</span><br><span class="line">    values in the Scheme list VALS. Both FORMALS and VALS are represented</span><br><span class="line">    as Pairs. Raise an error if too many or too few vals are given.</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">    &gt;&gt;&gt; formals, expressions = read_line(&#x27;(a b c)&#x27;), read_line(&#x27;(1 2 3)&#x27;)</span><br><span class="line">    &gt;&gt;&gt; env.make_child_frame(formals, expressions)</span><br><span class="line">    &lt;&#123;a: 1, b: 2, c: 3&#125; -&gt; &lt;Global Frame&gt;&gt;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if len(formals) != len(vals):</span><br><span class="line">        raise SchemeError(&#x27;Incorrect number of arguments to function call&#x27;)</span><br><span class="line">    # BEGIN PROBLEM 8</span><br><span class="line">    &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">    child_frame = Frame(self)</span><br><span class="line">    while formals is not nil and vals is not nil:</span><br><span class="line">        child_frame.define(formals.first, vals.first)</span><br><span class="line">        formals, vals = formals.rest, vals.rest</span><br><span class="line">    return child_frame</span><br><span class="line">    # END PROBLEM 8</span><br></pre></td></tr></table></figure>
<h2 id="Problem-9-2-pt-2">Problem 9 (2 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 09 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 9 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 6)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 9 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 9 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 9 &gt; Suite 2 &gt; Case 2</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 9 &gt; Suite 3 &gt; Case 1</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (define outer (lambda (x y)</span><br><span class="line">....   (define inner (lambda (z x)</span><br><span class="line">....     (+ x (* y 2) (* z 3))))</span><br><span class="line">....   (inner x 10)))</span><br><span class="line">? outer</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (outer 1 2)</span><br><span class="line">? 17</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (define outer-func (lambda (x y)</span><br><span class="line">....   (define inner (lambda (z x)</span><br><span class="line">....     (+ x (* y 2) (* z 3))))</span><br><span class="line">....   inner))</span><br><span class="line">? outer-func</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; ((outer-func 1 2) 1 10)</span><br><span class="line">? 17</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 9 &gt; Suite 3 &gt; Case 2</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 9 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_eval_apply.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">def scheme_apply(procedure, args, env):</span><br><span class="line">    &quot;&quot;&quot;Apply Scheme PROCEDURE to argument values ARGS (a Scheme list) in</span><br><span class="line">    Frame ENV, the current environment.&quot;&quot;&quot;</span><br><span class="line">    validate_procedure(procedure)</span><br><span class="line">    if isinstance(procedure, BuiltinProcedure):</span><br><span class="line">        # BEGIN PROBLEM 2</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        args_list = pair_to_list(args)</span><br><span class="line">        if procedure.expect_env:</span><br><span class="line">            args_list.append(env)</span><br><span class="line">        try:</span><br><span class="line">            return procedure.py_func(*args_list)</span><br><span class="line">        except TypeError:</span><br><span class="line">            raise SchemeError(&#x27;incorrect number of arguments&#x27;)</span><br><span class="line">        # END PROBLEM 2</span><br><span class="line">    elif isinstance(procedure, LambdaProcedure):</span><br><span class="line">        # BEGIN PROBLEM 9</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        child_frame = procedure.env.make_child_frame(procedure.formals, args)</span><br><span class="line">        return eval_all(procedure.body, child_frame)</span><br><span class="line">        # END PROBLEM 9</span><br><span class="line">    elif isinstance(procedure, MuProcedure):</span><br><span class="line">        # BEGIN PROBLEM 11</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        # END PROBLEM 11</span><br><span class="line">    else:</span><br><span class="line">        assert False, &quot;Unexpected procedure: &#123;&#125;&quot;.format(procedure)</span><br></pre></td></tr></table></figure>
<h2 id="Problem-10-1-pt-3">Problem 10 (1 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 10 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 10 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 7)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (define (f x y) (+ x y))</span><br><span class="line">? f</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; f</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) (define f (lambda (x y) (+ x y)))</span><br><span class="line">1) (lambda (f x y) (+ x y))</span><br><span class="line">2) (lambda (x y) (+ x y))</span><br><span class="line">3) (f (x y) (+ x y))</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 10 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 6)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 10 &gt; Suite 1 &gt; Case 3</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 10 &gt; Suite 1 &gt; Case 4</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 10 &gt; Suite 1 &gt; Case 5</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 10 &gt; Suite 1 &gt; Case 6</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 10 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 10 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_forms.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">def do_define_form(expressions, env):</span><br><span class="line">    &quot;&quot;&quot;Evaluate a define form.</span><br><span class="line">    &gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">    &gt;&gt;&gt; do_define_form(read_line(&quot;(x 2)&quot;), env) # evaluating (define x 2)</span><br><span class="line">    &#x27;x&#x27;</span><br><span class="line">    &gt;&gt;&gt; scheme_eval(&quot;x&quot;, env)</span><br><span class="line">    2</span><br><span class="line">    &gt;&gt;&gt; do_define_form(read_line(&quot;(x (+ 2 8))&quot;), env) # evaluating (define x (+ 2 8))</span><br><span class="line">    &#x27;x&#x27;</span><br><span class="line">    &gt;&gt;&gt; scheme_eval(&quot;x&quot;, env)</span><br><span class="line">    10</span><br><span class="line">    &gt;&gt;&gt; # problem 10</span><br><span class="line">    &gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">    &gt;&gt;&gt; do_define_form(read_line(&quot;((f x) (+ x 2))&quot;), env) # evaluating (define (f x) (+ x 8))</span><br><span class="line">    &#x27;f&#x27;</span><br><span class="line">    &gt;&gt;&gt; scheme_eval(read_line(&quot;(f 3)&quot;), env)</span><br><span class="line">    5</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    validate_form(expressions, 2)  # Checks that expressions is a list of length at least 2</span><br><span class="line">    signature = expressions.first</span><br><span class="line">    if scheme_symbolp(signature):</span><br><span class="line">        # assigning a name to a value e.g. (define x (+ 1 2))</span><br><span class="line">        validate_form(expressions, 2, 2)  # Checks that expressions is a list of length exactly 2</span><br><span class="line">        # BEGIN PROBLEM 4</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        value = scheme_eval(expressions.rest.first, env)</span><br><span class="line">        env.define(signature, value)</span><br><span class="line">        return signature</span><br><span class="line">        # END PROBLEM 4</span><br><span class="line">    elif isinstance(signature, Pair) and scheme_symbolp(signature.first):</span><br><span class="line">        # defining a named procedure e.g. (define (f x y) (+ x y))</span><br><span class="line">        # BEGIN PROBLEM 10</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        formal = signature.rest</span><br><span class="line">        while formal is not nil:</span><br><span class="line">            if not scheme_symbolp(formal.first):</span><br><span class="line">                raise SchemeError</span><br><span class="line">            formal = formal.rest</span><br><span class="line">        </span><br><span class="line">        env.define(signature.first, LambdaProcedure(signature.rest, expressions.rest, env))</span><br><span class="line">        return signature.first</span><br><span class="line">        # END PROBLEM 10</span><br><span class="line">    else:</span><br><span class="line">        bad_signature = signature.first if isinstance(signature, Pair) else signature</span><br><span class="line">        raise SchemeError(&#x27;non-symbol: &#123;0&#125;&#x27;.format(bad_signature))</span><br></pre></td></tr></table></figure>
<h2 id="Problem-11-1-pt-3">Problem 11 (1 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 11 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 11 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (define y 1)</span><br><span class="line">? y</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (define f (mu (x) (+ x y)))</span><br><span class="line">? f</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (define g (lambda (x y) (f (+ x x))))</span><br><span class="line">? g</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (g 3 7)</span><br><span class="line">? 13</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 11 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 11 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_forms.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def do_mu_form(expressions, env):</span><br><span class="line">    &quot;&quot;&quot;Evaluate a mu form.&quot;&quot;&quot;</span><br><span class="line">    validate_form(expressions, 2)</span><br><span class="line">    formals = expressions.first</span><br><span class="line">    validate_formals(formals)</span><br><span class="line">    # BEGIN PROBLEM 11</span><br><span class="line">    &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">    return MuProcedure(formals, expressions.rest)</span><br><span class="line">    # END PROBLEM 11</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_eval_apply.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def scheme_apply(procedure, args, env):</span><br><span class="line">    &quot;&quot;&quot;Apply Scheme PROCEDURE to argument values ARGS (a Scheme list) in</span><br><span class="line">    Frame ENV, the current environment.&quot;&quot;&quot;</span><br><span class="line">    validate_procedure(procedure)</span><br><span class="line">    if isinstance(procedure, BuiltinProcedure):</span><br><span class="line">        # BEGIN PROBLEM 2</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        args_list = pair_to_list(args)</span><br><span class="line">        if procedure.expect_env:</span><br><span class="line">            args_list.append(env)</span><br><span class="line">        try:</span><br><span class="line">            return procedure.py_func(*args_list)</span><br><span class="line">        except TypeError:</span><br><span class="line">            raise SchemeError(&#x27;incorrect number of arguments&#x27;)</span><br><span class="line">        # END PROBLEM 2</span><br><span class="line">    elif isinstance(procedure, LambdaProcedure):</span><br><span class="line">        # BEGIN PROBLEM 9</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        child_frame = procedure.env.make_child_frame(procedure.formals, args)</span><br><span class="line">        return eval_all(procedure.body, child_frame)</span><br><span class="line">        # END PROBLEM 9</span><br><span class="line">    elif isinstance(procedure, MuProcedure):</span><br><span class="line">        # BEGIN PROBLEM 11</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        child_frame = env.make_child_frame(procedure.formals, args)</span><br><span class="line">        return eval_all(procedure.body, child_frame)</span><br><span class="line">        # END PROBLEM 11</span><br><span class="line">    else:</span><br><span class="line">        assert False, &quot;Unexpected procedure: &#123;&#125;&quot;.format(procedure)</span><br></pre></td></tr></table></figure>
<h2 id="Problem-12-2-pt-2">Problem 12 (2 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 12 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 12 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 9)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (and)</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) #f</span><br><span class="line">1) SchemeError</span><br><span class="line">2) #t</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (and 1 #f)</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) #t</span><br><span class="line">1) #f</span><br><span class="line">2) 1</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (and (+ 1 1) 1)</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (and #f 5)</span><br><span class="line">? #f</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (and 4 5 (+ 3 3))</span><br><span class="line">? 6</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (not (and #t #f 42 (/ 1 0)))</span><br><span class="line">? #t</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 12 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 8)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 12 &gt; Suite 1 &gt; Case 3</span><br><span class="line">(cases remaining: 7)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 12 &gt; Suite 1 &gt; Case 4</span><br><span class="line">(cases remaining: 6)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 12 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (or)</span><br><span class="line">? #f</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (or (+ 1 1))</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (not (or #f))</span><br><span class="line">? #t</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (define (zero) 0)</span><br><span class="line">? zero</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (or (zero) 3)</span><br><span class="line">? 0</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (or 4 #t (/ 1 0))</span><br><span class="line">? 4</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 12 &gt; Suite 2 &gt; Case 2</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 12 &gt; Suite 2 &gt; Case 3</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 12 &gt; Suite 2 &gt; Case 4</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 12 &gt; Suite 2 &gt; Case 5</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 12 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_forms.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">def do_and_form(expressions, env):</span><br><span class="line">    &quot;&quot;&quot;Evaluate a (short-circuited) and form.</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">    &gt;&gt;&gt; do_and_form(read_line(&quot;(#f (print 1))&quot;), env) # evaluating (and #f (print 1))</span><br><span class="line">    False</span><br><span class="line">    &gt;&gt;&gt; # evaluating (and (print 1) (print 2) (print 4) 3 #f)</span><br><span class="line">    &gt;&gt;&gt; do_and_form(read_line(&quot;((print 1) (print 2) (print 3) (print 4) 3 #f)&quot;), env)</span><br><span class="line">    1</span><br><span class="line">    2</span><br><span class="line">    3</span><br><span class="line">    4</span><br><span class="line">    False</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # BEGIN PROBLEM 12</span><br><span class="line">    &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">    if expressions is nil:</span><br><span class="line">        return True</span><br><span class="line">    val = scheme_eval(expressions.first, env)</span><br><span class="line">    if is_scheme_true(val):</span><br><span class="line">        if expressions.rest is nil:</span><br><span class="line">            return val</span><br><span class="line">        else:</span><br><span class="line">            return do_and_form(expressions.rest, env)</span><br><span class="line">    else:</span><br><span class="line">        return False</span><br><span class="line">    # END PROBLEM 12</span><br><span class="line"></span><br><span class="line">def do_or_form(expressions, env):</span><br><span class="line">    &quot;&quot;&quot;Evaluate a (short-circuited) or form.</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; env = create_global_frame()</span><br><span class="line">    &gt;&gt;&gt; do_or_form(read_line(&quot;(10 (print 1))&quot;), env) # evaluating (or 10 (print 1))</span><br><span class="line">    10</span><br><span class="line">    &gt;&gt;&gt; do_or_form(read_line(&quot;(#f 2 3 #t #f)&quot;), env) # evaluating (or #f 2 3 #t #f)</span><br><span class="line">    2</span><br><span class="line">    &gt;&gt;&gt; # evaluating (or (begin (print 1) #f) (begin (print 2) #f) 6 (begin (print 3) 7))</span><br><span class="line">    &gt;&gt;&gt; do_or_form(read_line(&quot;((begin (print 1) #f) (begin (print 2) #f) 6 (begin (print 3) 7))&quot;), env)</span><br><span class="line">    1</span><br><span class="line">    2</span><br><span class="line">    6</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # BEGIN PROBLEM 12</span><br><span class="line">    &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">    if expressions is nil:</span><br><span class="line">        return False</span><br><span class="line">    val = scheme_eval(expressions.first, env)</span><br><span class="line">    if is_scheme_true(val):</span><br><span class="line">        return val</span><br><span class="line">    else:</span><br><span class="line">        return do_or_form(expressions.rest, env)</span><br><span class="line">    # END PROBLEM 12</span><br></pre></td></tr></table></figure>
<h2 id="Problem-13-2-pt-2">Problem 13 (2 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 13 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 13 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 6)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (cond ((&gt; 2 3) 5)</span><br><span class="line">....       ((&gt; 2 4) 6)</span><br><span class="line">....       ((&lt; 2 5) 7)</span><br><span class="line">....       (else 8))</span><br><span class="line">? 7</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (cond ((&gt; 2 3) 5)</span><br><span class="line">....       ((&gt; 2 4) 6)</span><br><span class="line">....       (else 8))</span><br><span class="line">? 8</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (cond ((= 1 1))</span><br><span class="line">....       ((= 4 4) &#x27;huh)</span><br><span class="line">....       (else &#x27;no))</span><br><span class="line">? #t</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 13 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 13 &gt; Suite 2 &gt; Case 2</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 13 &gt; Suite 2 &gt; Case 3</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 13 &gt; Suite 2 &gt; Case 4</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 13 &gt; Suite 2 &gt; Case 5</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 13 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_forms.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def do_cond_form(expressions, env):</span><br><span class="line">    &quot;&quot;&quot;Evaluate a cond form.</span><br><span class="line"></span><br><span class="line">    &gt;&gt;&gt; do_cond_form(read_line(&quot;((#f (print 2)) (#t 3))&quot;), create_global_frame())</span><br><span class="line">    3</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    while expressions is not nil:</span><br><span class="line">        clause = expressions.first</span><br><span class="line">        validate_form(clause, 1)</span><br><span class="line">        if clause.first == &#x27;else&#x27;:</span><br><span class="line">            test = True</span><br><span class="line">            if expressions.rest != nil:</span><br><span class="line">                raise SchemeError(&#x27;else must be last&#x27;)</span><br><span class="line">        else:</span><br><span class="line">            test = scheme_eval(clause.first, env)</span><br><span class="line">        if is_scheme_true(test):</span><br><span class="line">            # BEGIN PROBLEM 13</span><br><span class="line">            &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">            if clause.rest is nil:</span><br><span class="line">                return test</span><br><span class="line">            else:</span><br><span class="line">                return eval_all(clause.rest, env)</span><br><span class="line">            # END PROBLEM 13</span><br><span class="line">        expressions = expressions.rest</span><br></pre></td></tr></table></figure>
<h2 id="Problem-14-2-pt-2">Problem 14 (2 pt)</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">$ python3 ok -q 14 -u</span><br><span class="line">=====================================================================</span><br><span class="line">Assignment: Project 4: Scheme Interpreter</span><br><span class="line">OK, version v1.18.1</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">Unlocking tests</span><br><span class="line"></span><br><span class="line">At each &quot;? &quot;, type what you would expect the output to be.</span><br><span class="line">Type exit() to quit</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 14 &gt; Suite 1 &gt; Case 1</span><br><span class="line">(cases remaining: 9)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (define x 1)</span><br><span class="line">? x</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (let ((x 5))</span><br><span class="line">....    (+ x 3))</span><br><span class="line">? 8</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; x</span><br><span class="line">? 1</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 14 &gt; Suite 1 &gt; Case 2</span><br><span class="line">(cases remaining: 8)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (let ((a 1) (b a)) b)</span><br><span class="line">Choose the number of the correct choice:</span><br><span class="line">0) y</span><br><span class="line">1) 1</span><br><span class="line">2) SchemeError</span><br><span class="line">3) x</span><br><span class="line">? 2</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 14 &gt; Suite 1 &gt; Case 3</span><br><span class="line">(cases remaining: 7)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (let ((x 5))</span><br><span class="line">....    (let ((x 2)</span><br><span class="line">....          (y x))</span><br><span class="line">....        (+ y (* x 2))))</span><br><span class="line">? 9</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 14 &gt; Suite 1 &gt; Case 4</span><br><span class="line">(cases remaining: 6)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scm&gt; (let ((a 2) (a 3)) (+ a a)) ; how should we catch something like this?</span><br><span class="line">? SchemeError</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">scm&gt; (let ((y 2 3)) (+ y y)) ; should this be an allowable form?</span><br><span class="line">? SchemeError</span><br><span class="line">-- OK! --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 14 &gt; Suite 1 &gt; Case 5</span><br><span class="line">(cases remaining: 5)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 14 &gt; Suite 2 &gt; Case 1</span><br><span class="line">(cases remaining: 4)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 14 &gt; Suite 2 &gt; Case 2</span><br><span class="line">(cases remaining: 3)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 14 &gt; Suite 2 &gt; Case 3</span><br><span class="line">(cases remaining: 2)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Problem 14 &gt; Suite 3 &gt; Case 1</span><br><span class="line">(cases remaining: 1)</span><br><span class="line"></span><br><span class="line">-- Already unlocked --</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">OK! All cases for Problem 14 unlocked.</span><br></pre></td></tr></table></figure>
<p><strong>scheme/scheme_forms.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">def make_let_frame(bindings, env):</span><br><span class="line">    &quot;&quot;&quot;Create a child frame of Frame ENV that contains the definitions given in</span><br><span class="line">    BINDINGS. The Scheme list BINDINGS must have the form of a proper bindings</span><br><span class="line">    list in a let expression: each item must be a list containing a symbol</span><br><span class="line">    and a Scheme expression.&quot;&quot;&quot;</span><br><span class="line">    if not scheme_listp(bindings):</span><br><span class="line">        raise SchemeError(&#x27;bad bindings list in let form&#x27;)</span><br><span class="line">    names = vals = nil</span><br><span class="line">    # BEGIN PROBLEM 14</span><br><span class="line">    &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">    while bindings is not nil:</span><br><span class="line">        validate_form(bindings.first, 2, 2)</span><br><span class="line">        name = (bindings.first.first)</span><br><span class="line">        val = (scheme_eval(bindings.first.rest.first, env))</span><br><span class="line"></span><br><span class="line">        if names is nil:</span><br><span class="line">            names = Pair(name, nil)</span><br><span class="line">            name_tmp = names</span><br><span class="line">        else:</span><br><span class="line">            name_tmp.rest = Pair(name, nil)</span><br><span class="line">            name_tmp = name_tmp.rest</span><br><span class="line">        if vals is nil:</span><br><span class="line">            vals = Pair(val, nil)</span><br><span class="line">            val_tmp = vals</span><br><span class="line">        else:</span><br><span class="line">            val_tmp.rest = Pair(val, nil)</span><br><span class="line">            val_tmp = val_tmp.rest</span><br><span class="line">        bindings = bindings.rest</span><br><span class="line"></span><br><span class="line">    validate_formals(names)</span><br><span class="line">    # END PROBLEM 14</span><br><span class="line">    return env.make_child_frame(names, vals)</span><br></pre></td></tr></table></figure>
<h2 id="Problem-15-2-pt-2">Problem 15 (2 pt)</h2>
<p><strong>scheme/questions.scm</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">;; Problem 15</span><br><span class="line">;; Returns a list of two-element lists</span><br><span class="line">(define (enumerate s)</span><br><span class="line">  ; BEGIN PROBLEM 15</span><br><span class="line">  &#x27;replace-this-line</span><br><span class="line">  (define (help idx ele)</span><br><span class="line">      (if (null? ele) nil</span><br><span class="line">          (cons (list idx (car ele)) (help (+ idx 1) (cdr ele))))) (help 0 s)</span><br><span class="line">  )</span><br><span class="line">  ; END PROBLEM 15</span><br></pre></td></tr></table></figure>
<h2 id="Problem-16-2-pt-2">Problem 16 (2 pt)</h2>
<p><strong>scheme/questions.scm</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">;; Problem 16</span><br><span class="line"></span><br><span class="line">;; Merge two lists LIST1 and LIST2 according to INORDER? and return</span><br><span class="line">;; the merged lists.</span><br><span class="line">(define (merge inorder? list1 list2)</span><br><span class="line">  ; BEGIN PROBLEM 16</span><br><span class="line">  &#x27;replace-this-line</span><br><span class="line">  (cond ((null? list1) list2)</span><br><span class="line">       ((null? list2) list1)</span><br><span class="line">       (else</span><br><span class="line">            (if (inorder? (car list1) (car list2))</span><br><span class="line">                (cons (car list1) (merge inorder? (cdr list1) list2))</span><br><span class="line">                (cons (car list2) (merge inorder? list1 (cdr list2)))</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">  )</span><br><span class="line">  )</span><br><span class="line">  ; END PROBLEM 16</span><br></pre></td></tr></table></figure>
<h2 id="Problem-EC-1-2-pt-2">Problem EC 1 (2 pt)</h2>
<p><strong>scheme/scheme_eval_apply.py</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def optimize_tail_calls(unoptimized_scheme_eval):</span><br><span class="line">    &quot;&quot;&quot;Return a properly tail recursive version of an eval function.&quot;&quot;&quot;</span><br><span class="line">    def optimized_eval(expr, env, tail=False):</span><br><span class="line">        &quot;&quot;&quot;Evaluate Scheme expression EXPR in Frame ENV. If TAIL,</span><br><span class="line">        return an Unevaluated containing an expression for further evaluation.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if tail and not scheme_symbolp(expr) and not self_evaluating(expr):</span><br><span class="line">            return Unevaluated(expr, env)</span><br><span class="line"></span><br><span class="line">        result = Unevaluated(expr, env)</span><br><span class="line">        # BEGIN PROBLEM EC</span><br><span class="line">        &quot;*** YOUR CODE HERE ***&quot;</span><br><span class="line">        while isinstance(result, Unevaluated):</span><br><span class="line">            result = unoptimized_scheme_eval(result.expr, result.env)</span><br><span class="line">        return result</span><br><span class="line">        # END PROBLEM EC</span><br><span class="line">    return optimized_eval</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/CS61A"><i class="fa fa-tag">CS61A</i></a></div><div class="post-nav"><a class="pre" href="/2023/01/20/CS61C-%E6%80%BB%E7%BB%93/">CS61C 总结</a><a class="next" href="/2022/12/16/CS188-Proj-2/">CS188 Proj 2</a></div><div id="tcomment"></div><script src="https://unpkg.com/twikoo@1.5.7/dist/twikoo.all.min.js"></script><script>twikoo.init({
  envId: 'https://twikoo-f8467x06b-misaka-9982-coder.vercel.app/',
  el: '#tcomment',
  region: '',
  path: ''
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="/img/avatar.jpeg"/></a><p>Try to be better.</p><a class="info-icon" href="https://twitter.com/Misaka___9982" title="Twitter" target="_blank" style="margin-inline:5px"> <i class="fa fa-twitter-square" style="margin-inline:5px"></i></a><a class="info-icon" href="mailto:1784321894@qq.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/Misaka-9982-coder" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/OS/" style="font-size: 15px;">OS</a> <a href="/tags/6-S081/" style="font-size: 15px;">6.S081</a> <a href="/tags/Acwing/" style="font-size: 15px;">Acwing</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/CS144/" style="font-size: 15px;">CS144</a> <a href="/tags/Network/" style="font-size: 15px;">Network</a> <a href="/tags/CS188/" style="font-size: 15px;">CS188</a> <a href="/tags/AI/" style="font-size: 15px;">AI</a> <a href="/tags/CS61A/" style="font-size: 15px;">CS61A</a> <a href="/tags/CS61BL/" style="font-size: 15px;">CS61BL</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Wireshark/" style="font-size: 15px;">Wireshark</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/06/28/Codewar-%E4%BD%93%E9%AA%8C/">Codewar 体验</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/15/6-S081-Lab-3-page-tables/">6.S081 Lab 3 page tables</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/14/6-S081-Lab-2-System-Calls/">6.S081-Lab 2: System Calls</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/10/6-S081-Lab-1-Xv6-and-Unix-utilities/">6.S081-Lab 1: Xv6 and Unix utilities</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/09/6-S081%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">6.S081环境配置及参考资料</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/02/25/CS144-Lab7/">CS144-Lab7</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/02/25/CS144-Lab6/">CS144-Lab6</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/02/24/CS144-Lab5/">CS144-Lab5</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/02/20/Makefile-%E5%92%8C-CMake/">Makefile 和 CMake</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/02/19/CS144-Lab4/">CS144-Lab4</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.colopen-blog.com/" title="彩色铅笔" target="_blank">彩色铅笔</a><ul></ul><a href="https://www.selfknow.cn/" title="L2c" target="_blank">L2c</a><ul></ul><a href="https://blognas.hwb0307.com" title="浮云翩迁之间" target="_blank">浮云翩迁之间</a></div><div class="widget"><div class="widget-title"><i class="fa fa-heartbeat"> 访客地图</i></div></div><script id="clstr_globe" type="text/javascript" defer="defer" src="//clustrmaps.com/globe.js?d=NAGSI3cBPnTXd3xVo3V7zDC9xqeu_9ed2OCmGUj1uiw"></script><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async="async"></script><div class="widget"><div class="widget-title"><i class="fa fa-tags"> 网站资讯</i></div><ul> </ul><div class="webinfo-item"><div class="item-name">本站访客数  : </div><div class="item-count" id="busuanzi_value_site_uv"></div></div><ul> </ul><div class="webinfo-item"><div class="item-name">本站总访问量  : </div><div class="item-count" id="busuanzi_value_site_pv"></div></div><ul></ul><div class="webinfo-item"><div class="item-name">本站总字数 : </div><div class="item-count">301k</div></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 - 2023 <a href="/." rel="nofollow">Misaka's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>